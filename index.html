<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Was mich nicht umbringt, macht mich stärker">
<meta property="og:type" content="website">
<meta property="og:title" content="Shaw">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Shaw">
<meta property="og:description" content="Was mich nicht umbringt, macht mich stärker">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Shaw">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Shaw</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Shaw</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>resources</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/04/%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%BB%9F%E8%AE%A1-2-%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%8E%A8%E6%96%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/04/%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%BB%9F%E8%AE%A1-2-%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%8E%A8%E6%96%AD/" class="post-title-link" itemprop="url">贝叶斯统计 2 贝叶斯推断</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-04 13:11:03" itemprop="dateCreated datePublished" datetime="2022-05-04T13:11:03+08:00">2022-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-06 19:26:39" itemprop="dateModified" datetime="2022-05-06T19:26:39+08:00">2022-05-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bayesian-Statistics/" itemprop="url" rel="index"><span itemprop="name">Bayesian Statistics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="S-2-1-条件方法"><a href="#S-2-1-条件方法" class="headerlink" title="$\S 2.1\ $条件方法"></a><center>$\S 2.1\ $条件方法</center></h3><p>统计学中有一种重要的观点称为“条件观点”，即只考虑已出现的数据（样本观察值），而认为未出现的数据与推断无关。后验分布$\ \pi(\theta|\mathbf{x})\ $是在样本$\ \mathbf{x}\ $给定下$\ \theta\ $的条件分布，基于后验分布的统计推断就践行了这样的观点。我们将基于条件观点提出的统计推断方法称为条件方法。</p>
<h3 id="S-2-2-估计"><a href="#S-2-2-估计" class="headerlink" title="$\S 2.2\ $估计"></a><center>$\S 2.2\ $估计</center></h3><h4 id="贝叶斯估计"><a href="#贝叶斯估计" class="headerlink" title="贝叶斯估计"></a>贝叶斯估计</h4><p>设$\ \theta\ $是总体分布$\ p(x|\theta)$中的参数，为估计该参数可从总体中随机抽取一个样本$\ \mathbf{x}=(x_1,…,x_n)$，同时依据参数的先验信息选择一个先验分布（第三章将会讨论这个问题），用贝叶斯公式算得后验分布$\ \pi(\theta|\mathbf{x})\ $。最后，如果硬要我们拿出一个$\ \theta\ $的估计值出来，我们可以选用后验分布的某个位置特征值，如众数、中位数或者期望。</p>
<p>以下三个估计都成为$\ \theta\ $的贝叶斯估计：</p>
<ul>
<li>最大后验估计$\ \hat\theta_{MD}$：使后验密度$\ \pi(\theta|\mathbf{x})\ $达到最大值的$\ \theta$</li>
<li>后验中位数估计$\ \hat\theta_{Me}$：后验分布的中位数</li>
<li>后验期望估计$\ \hat\theta_{E}$：后验分布的期望值</li>
</ul>
<p>在这里提及以下事实：</p>
<ul>
<li>显然对于非对称后验分布，我们所得出来的估计量可能并不相同，在实际情况中需要再进行选择。而一条指导性意见是两个估计量在小样本上的解释性是否有哪个更优。</li>
<li>有时候我们所得的贝叶斯估计就是经典统计中的极大似然估计，例如在二项分布场合下，取特殊先验为均分分布的$\ \theta\ $，它的最大后验估计就是经典统计中的极大似然估计。贝叶斯学派对这种现象的看法是：任何使用经典统计的人都在自觉或者不自觉地使用贝叶斯推断，与其不自觉地使用，还不如主动选取更合适的先验分布使推断更富有意义。当然频率学派并不会接受这种观点，因为贝叶斯学派尚未证明：总体分布$\ p(x|\theta)\ $中参数的任一经典估计都存在一个先验分布，使得其贝叶斯估计就是该经典统计。</li>
</ul>
<p>更多更详细的内容请查阅参考文献《贝叶斯统计》第37至39页。</p>
<h4 id="贝叶斯估计的误差"><a href="#贝叶斯估计的误差" class="headerlink" title="贝叶斯估计的误差"></a>贝叶斯估计的误差</h4><p>在得到一个估计值之后，我们往往需要知道这个估计值究竟有多靠谱，能不能放心的在实际生活中进行使用，此时我们就需要考虑一个误差的问题了。而衡量误差很自然的想法就是利用方差或者是标准差，好在我们已经有关于参数$\ \theta\ $的后验分布，所以最好而又最简单的方法就是用$\ \theta\ $对$\ \hat\theta\ $的后验均方差或其平方根来度量。</p>
<p>设参数$\ \theta\ $的后验分布$\ \pi(\theta|\mathbf{x})\ $，贝叶斯估计为$\ \hat\theta\ $，则$\ (\theta-\hat\theta)^2\ $的后验期望</p>
<script type="math/tex; mode=display">
MSE(\hat\theta|\mathbf{x})=E^{\theta|\mathbf{x}}[(\theta-\hat\theta)^2]</script><p>称为$\ \hat\theta\ $的后验均方差，而其平方根$\ [MSE(\hat\theta|\mathbf{x})]^{1/2}\ $称为$\ \hat\theta\ $的后验标准误。其中符号$\ E^{\theta|\mathbf{x}}\ $表示用条件分布$\ \pi(\theta|\mathbf{x})\ $求期望。在连续情形下，有</p>
<script type="math/tex; mode=display">
E^{\theta|\mathbf{x}}[(\theta-\hat\theta)^2]=\int_{\Theta}(\theta-\hat\theta)^2\pi(\theta|\mathbf{x})d\theta</script><p>经过简单的推断，我们还可以得到后验均方差与后验均值之间的关系</p>
<script type="math/tex; mode=display">
MSE(\hat\theta|\mathbf{x})=Var(\theta|\mathbf{x})+(\hat\theta_E-\hat\theta)^2</script><p>其中$\ \hat\theta_E=E(\theta|\mathbf{x})$。</p>
<h3 id="S-2-3-区间估计"><a href="#S-2-3-区间估计" class="headerlink" title="$\S 2.3\ $区间估计"></a><center>$\S 2.3\ $区间估计</center></h3><p>由于贝叶斯学派将参数$\ \theta\ $视为随机变量，所以我们可以很自然的讨论关于$\ \theta\ $的区间估计问题。我们将这种区间称为贝叶斯可信区间。</p>
<p>而在经典统计中，我们也有类似的给出置信区间的结果。相比之下，置信区间就让人感觉有些摸不着头脑了。比如说我们在95%的置信水平下得到关于$\ \theta\ $的置信区间，此时我们并不允许说$\ \theta\ $落在此区间内的<strong>概率</strong>是0.95，因为对于非随机的常量$\ \theta$，我们并不能言及概率。事实上，给定一个置信区间，常量$\ \theta\ $要么落在置信区间内，要么不落在置信区间内，是一个确定性事件。我们只能以曲线救国的方式将置信区间视为<strong>随机置信区间</strong>说：“在100次使用这个置信区间时，大约有90次能盖住$\ \theta$。”而此种频率解释对仅使用一次或两次的人来说是毫无意义的。很多人还是会下意识将求得的置信区间当作可信区间去使用和理解。</p>
<p>设参数$\ \theta\ $的后验分布为$\ \pi(\theta|\mathbf{x})$，对于给定的样本$\ \mathbf{x}\ $和概率$\ 1-\alpha(0&lt;\alpha&lt;1)$，若存在这样的两个统计量$\ \hat\theta_L=\hat\theta_L(\mathbf{x})\ $与$\ \hat\theta_U=\hat\theta_U(\mathbf{x})$，使得</p>
<script type="math/tex; mode=display">
P(\hat\theta_L\le\theta\le\hat\theta_U|\mathbf{x})\ge 1-\alpha</script><p>则称区间$\ [\hat\theta_L,\hat\theta_U]\ $为参数$\ \theta\ $的可信水平为$\ 1-\alpha\ $（贝叶斯）可信区间。而满足</p>
<script type="math/tex; mode=display">
P(\theta\ge\hat\theta_L|\mathbf{x})\ge 1-\alpha</script><p>的$\ \hat\theta_L\ $称为$\ \theta\ $的$\ 1-\alpha$（单侧）可信下限。满足</p>
<script type="math/tex; mode=display">
P(\theta\le\hat\theta_U|\mathbf{x})\ge 1-\alpha</script><p>的$\ \hat\theta_U\ $称为$\ \theta\ $的$\ 1-\alpha$（单侧）可信上限。</p>
<ul>
<li><p>对给定的可信水平$\ 1-\alpha$，从后验分布$\ \pi(\theta|\mathbf{x})\ $获得的可信区间不止一个，常用的方法是用$\ \alpha/2\ $和$\ 1-\alpha/2\ $的分位数来获得$\ \theta\ $的可信区间。</p>
</li>
<li><p>等尾可信区间在实际中常常被使用，但并不是最理想的，最理想的可信区间应是区间长度最短。这只要把具有最大后验密度的点都包含在区间中，而在区间外的点上的后验密度函数值均不超过区间内的函数值。我们称这样的区间为最大后验密度（Highest Posterior Density，HPD）可信区间。</p>
</li>
</ul>
<h3 id="S-2-4-假设检验"><a href="#S-2-4-假设检验" class="headerlink" title="$\S 2.4\ $假设检验"></a><center>$\S 2.4\ $假设检验</center></h3><h4 id="假设检验"><a href="#假设检验" class="headerlink" title="假设检验"></a>假设检验</h4><p>考虑这样的假设检验问题：建立原假设$\ H_0\ $与备择假设$\ H_1\ $</p>
<script type="math/tex; mode=display">
H_0:\theta\in\Theta_0,\quad H_1:\theta\in\Theta_1</script><p>其中$\ \Theta_0\cap\Theta_1=\empty$。</p>
<p>在贝叶斯统计中处理假设检验问题是直截了当的，在获得后验分布$\ \pi(\theta|\mathbf{x})\ $后，即可计算两个假设$\ H_0\ $和$\ H_1\ $的后验概率</p>
<script type="math/tex; mode=display">
\alpha_i=P(\Theta_i|\mathbf{x})d\theta,\quad i=0,1</script><p>然后比较$\ \alpha_0\ $与$\ \alpha_1\ $的大小：</p>
<ul>
<li>当后验概率比（或称后验机会比）$\alpha_0/\alpha_1\gt 1$时接受$\ H_0\ $；</li>
<li>当后验概率比（或称后验机会比）$\alpha_0/\alpha_1\lt 1$时接受$\ H_1\ $；</li>
<li>当后验概率比（或称后验机会比）$\alpha_0/\alpha_1=1$时不做判断</li>
</ul>
<p>可以看到比起经典统计下的假设检验，我们并不需要选择检验统计量，确定抽样分布，也无需事先给定显著性水平，确定其拒绝域。</p>
<p>最后，当我们推广到多重假设检验场合时，应接受具有最大后验概率的假设。</p>
<h4 id="贝叶斯因子"><a href="#贝叶斯因子" class="headerlink" title="贝叶斯因子"></a>贝叶斯因子</h4><p>贝叶斯因子即是后验机会比/先验机会比</p>
<p>我们通过定义来感受一下贝叶斯因子究竟在干什么：</p>
<script type="math/tex; mode=display">
B_\pi(\mathbf{x})=\frac{后验机会比}{先验机会比}=\frac{\alpha_0/\alpha_1}{\pi_0\pi_1}=\frac{\alpha_0\pi_1}{\alpha_1\pi_0}</script><p>首先分子“后验机会比”已经将后验的信息进行很好的利用（这其中就包含了样本信息和先验信息），但是接着我们又将该值除以先验机会比。</p>
<p>刚开始接触这个概念时，我误以为贝叶斯因子是和后验机会比一样是用来判定假设检验的结果的。那么这就产生了一个很奇怪的问题了，我们看到贝叶斯因子既依赖于数据，又依赖于先验分布，对两种机会比相除，直观上这会削弱甚至（在某些情况下会）消除先验的影响。不过后来发现它并不是用来判定的……注意到贝叶斯因子减弱了先验的影响，突出了数据的影响，从这个角度看，贝叶斯因子是衡量了数据支持原假设的程度。</p>
<p>在简单假设$\ \Theta_0=\{\theta_0\}\ v.s.\Theta_1=\{\theta_1\}$下：</p>
<ul>
<li><p>两种简单假设的后验概率分别为</p>
<script type="math/tex; mode=display">
\alpha_0=\frac{\pi_0p(\mathbf{x}|\theta_0)}{\pi_0p(\mathbf{x}|\theta_0)+\pi_1p(\mathbf{x}|\theta_1)},\quad \alpha_1=\frac{\pi_1p(\mathbf{x}|\theta_1)}{\pi_0p(\mathbf{x}|\theta_0)+\pi_1p(\mathbf{x}|\theta_1)}</script></li>
<li><p>计算贝叶斯因子</p>
<script type="math/tex; mode=display">
B^\pi(\mathbf{x})=\frac{\alpha_0\pi_1}{\alpha_1\pi_0}=\frac{p(\mathbf{x}|\theta_0)}{p(\mathbf{x}|\theta_1)}</script><p>贝叶斯因子不依赖于先验分布，仅依赖于样本的似然比。这时贝叶斯因子的大小表示了样本$\ \mathbf{x}\ $支持$\ \Theta_0\ $的程度。</p>
</li>
</ul>
<p>在复杂假设下，贝叶斯因子虽然已经不是似然比了，但仍可以看成是原假设与备择假设的加权似然比，它平均的消除了先验分布的影响，而强调了样本观察值的作用。</p>
<p>在简单原假设对复杂的备择假设的场合下，例如很经典的检验问题$\ H_0=\theta_0\ v.s.H_1=\theta_1$。有别于前面问题的是不能采用连续密度函数作为先验分布，因为任何这种先验将给$\ \theta=\theta_0\ $的先验概率为0。基本的想法是赋予$\ \theta_0\ $一个正的概率，采用由离散和连续两部分组成的先验分布。</p>
<p>关于以上两个场合的假设检验问题更加详细的内容，感兴趣的同学请参看《贝叶斯统计》P54~63。</p>
<h3 id="S-2-5-预测"><a href="#S-2-5-预测" class="headerlink" title="$\S 2.5\ $预测"></a><center>$\S 2.5\ $预测</center></h3><p>对随机变量未来观察值作出统计推断称为预测，譬如：</p>
<ol>
<li>设随机变量$\ X\sim p(x|\theta)$，在参数$\ \theta\ $未知情况下如何对$\ X\ $的未来的观察值作出推断</li>
<li>设$\ x_1,…x_n\ $是来自$\ p(x|\theta)\ $​的过去观察值，在参数$\ \theta\ $未知情况下如何对$\ X\ $的未来的观察值作出推断</li>
<li>按密度函数$\ p(x|\theta)\ $得到一些数据$\ x_1,…x_n\ $后，如何对具有密度函数$\ g(z|\theta)\ $的随机变量$\ Z\ $的未来的观察值作出推断，这里第二个密度函数$\ p\ $和$\ g\ $都含有相同的未知参数$\ \theta$。</li>
</ol>
<p>在贝叶斯统计中，由于参数$\ \theta\ $随机且不可观测，我们的想法就是利用$\ \theta\ $的先验分布或者后验分布综合地考虑所有$\ \theta\ $的可能取值。共同点都是要获得预测分布。</p>
<ol>
<li><p>设随机变量$\ X\sim p(x|\theta)$，在无$\ X\ $的观察数据时，利用先验分布$\ \pi(\theta)\ $得到未知的但可以观测的数据$\ x\ $的分布</p>
<script type="math/tex; mode=display">
m(x)=\int_\Theta p(x|\theta)\pi(\theta)d\theta</script><p>这个分布常被称为$\ X\ $的边缘分布，但它还有一个更富有内涵的名称是“先验预测分布”。有了预测分布之后，我们就可以根据所需例如取期望值、中位数或众数作为预测值，也可以类似可信区间的形式取得预测区间。</p>
</li>
<li><p>在有$\ X\ $的观察数据$\ \mathbf{x}=(x_1,…,x_n)\ $时，改用后验分布$\pi(\theta|\mathbf{x})\ $获得“后验预测分布”</p>
<script type="math/tex; mode=display">
m(x|\mathbf{x})=\int_\Theta p(x|\theta)\pi(\theta|\mathbf{x})d\theta</script><p>也可以预测另一个总体$\ g(z|\theta)\ $的未来观察值，只要考虑如下分布：</p>
<script type="math/tex; mode=display">
m(z|\mathbf{x})=\int_\Theta g(z|\theta)\pi(\theta|\mathbf{x})d\theta</script></li>
</ol>
<h3 id="S-2-6-似然原理"><a href="#S-2-6-似然原理" class="headerlink" title="$\S 2.6\ $似然原理"></a><center>$\S 2.6\ $似然原理</center></h3><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>《贝叶斯统计》第2版  by 茆诗松，汤银才</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/30/%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%BB%9F%E8%AE%A1-1-%E5%85%88%E9%AA%8C%E5%88%86%E5%B8%83%E4%B8%8E%E5%90%8E%E9%AA%8C%E5%88%86%E5%B8%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/30/%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%BB%9F%E8%AE%A1-1-%E5%85%88%E9%AA%8C%E5%88%86%E5%B8%83%E4%B8%8E%E5%90%8E%E9%AA%8C%E5%88%86%E5%B8%83/" class="post-title-link" itemprop="url">贝叶斯统计 1 先验分布与后验分布</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-30 10:42:06" itemprop="dateCreated datePublished" datetime="2022-04-30T10:42:06+08:00">2022-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-05 13:17:43" itemprop="dateModified" datetime="2022-05-05T13:17:43+08:00">2022-05-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bayesian-Statistics/" itemprop="url" rel="index"><span itemprop="name">Bayesian Statistics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>统计学中主要有两个学派：频率学派与贝叶斯学派。要说清楚它们之间的关系，我们先从统计推断中的三种信息说起。</p>
<h3 id="S-1-1-三种信息"><a href="#S-1-1-三种信息" class="headerlink" title="$\S 1.1\ $三种信息"></a><center>$\S 1.1\ $三种信息</center></h3><h4 id="总体信息"><a href="#总体信息" class="headerlink" title="总体信息"></a>总体信息</h4><p>总体信息即是总体分布或总体所属分布族给我们的信息。总体信息是很重要的，但是为了获取这种信息往往耗资巨大。</p>
<h4 id="样本信息"><a href="#样本信息" class="headerlink" title="样本信息"></a>样本信息</h4><p>样本信息即从总体抽取的样本给我们的提供的信息。人们希望通过样本信息对总体的某些特征进行较为精确的统计推断。没有样本就没有统计学可言。</p>
<h4 id="先验信息"><a href="#先验信息" class="headerlink" title="先验信息"></a>先验信息</h4><p>先验信息是在抽样之前有关统计问题的一些信息，一般来说，先验信息主要来源于经验和历史资料。很显然，成熟而靠谱的经验有助于我们得到更加精确的结论。例如一个常饮牛奶加茶的女士声称她能辨别出先倒进杯子的究竟是牛奶还是茶。对此统计学家做了十次试验，结果发现她每次都正确说出来了。而当无知的统计学家妄自尊大地想自己去尝试辨别（盲猜）时，却只成功猜中了4次。在这种情况下，我们确实看到了经验对于推断产生的影响。</p>
<p>基于上述三种信息进行的统计推断称为贝叶斯统计学。它与经典的统计学的主要差别在于是否利用先验信息。另外，它们在使用样本信息上也是有差别的。贝叶斯学派重视已出现的样本观察值，而对尚未发生的样本观察值不予考虑。贝叶斯学派很重视先验信息的收集、挖掘和加工，使它数量化，形成先验分布，参加到统计推断中来，以提高统计推断的质量。</p>
<p>更具体地说，贝叶斯学派的最基本的观点就是：任一个未知量$\ \theta\ $都可以看作一个随机变量，应用一个概率分布去描述对$\ \theta\ $的未知情况。当然这个分布在未进行抽样之前就已经给出了，所以也被称为先验分布，或简称先验（prior）。而频率学派则认为$\ \theta\ $是一个常量，并不存在任何的不确定性。</p>
<h3 id="S-1-2-贝叶斯公式"><a href="#S-1-2-贝叶斯公式" class="headerlink" title="$\S 1.2\ $贝叶斯公式"></a><center>$\S 1.2\ $贝叶斯公式</center></h3><h4 id="贝叶斯公式的密度函数形式"><a href="#贝叶斯公式的密度函数形式" class="headerlink" title="贝叶斯公式的密度函数形式"></a>贝叶斯公式的密度函数形式</h4><ol>
<li><p>依赖于参数$\ \theta\ $的密度函数在经典统计中记为$p(x;\theta)$或者$p_\theta(x)$，它表示在参数空间$\Theta=\{\theta\}$中不同的$\ \theta\ $对应的不同的分布。可在贝叶斯统计中记为$\ p(x|\theta)$，它表示在随机变量给定某个值时，总体指标$\ X\ $的条件分布。</p>
</li>
<li><p>根据参数$\ \theta\ $的先验信息确定先验分布$\ \pi(\theta)\ $。</p>
</li>
<li><p>从贝叶斯观点看，样本$\ \mathbf{x}=(x_1,…,x_n)\ $的产生要分二步进行：</p>
<ul>
<li><p>首先设想从先验分布$\ \pi(\theta)\ $产生一个样本$\ \theta’\ $，这一步是人们看不到的；</p>
</li>
<li><p>第二步是从总体分布$\ p(x|\theta)\ $产生一个样本$\ \mathbf{x}=(x_1,…,x_n)\ $，这个样本是具体的，是人们能看得到的。此样本的$\ \vec{x}\ $发生的概率是与如下联合密度函数成正比</p>
<script type="math/tex; mode=display">
p(\mathbf{x}|\theta')=\prod_{i=1}^{n}p(x_i|\theta')</script><p>这个联合密度函数综合了<strong>总体信息</strong>和<strong>样本信息</strong>，常称为似然函数，记为$\ L(\theta’)$。在有了样本观察值之后，总体和样本信息中所含$\ \theta \ $的信息都被包含在似然函数$\ L(\theta’)\ $中。</p>
</li>
</ul>
</li>
<li><p>由于$\ \theta’\ $是由先验分布$\ \pi(\theta)\ $随机产生的，所以我们要利用<strong>先验信息</strong>把$\ \theta\ $所有可能的取值加以考虑。我们考虑样本和参数$\ \theta\ $的联合分布</p>
<script type="math/tex; mode=display">
h(\mathbf{x},\theta)=p(\mathbf{x}|\theta)\pi(\theta)</script><p>这样我们就把三种可用的信息都综合进去了。</p>
</li>
<li><p>我们的任务是对未知数$\ \theta\ $作出统计推断。在没有样本信息时，人们只能根据先验分布对$\ \theta\ $作出推断。在得到样本观察值$\ \mathbf{x}=(x_1,…,x_n)\ $之后，我们根据三种信息的综合$\ h(x,\theta)\ $对$\ \theta\ $作出推断。为此我们把$\ h(x,\theta)\ $进行如下分解：</p>
<script type="math/tex; mode=display">
h(\mathbf{x},\theta)=\pi(\theta|\mathbf{x})m(\mathbf{x})</script><p>其中$\ m(\mathbf{x})\ $是$\ \mathbf{x}\ $的边缘密度函数（$\ m(\mathbf{x})\ $还有其他的含义，我们将在第三章提及）：</p>
<script type="math/tex; mode=display">
m(\mathbf{x})=\int_{\Theta}h(\mathbf{x},\theta)d\theta=\int_{\Theta}p(\mathbf{x}|\theta)\pi(\theta)</script><p>为得到关于$\ \mathbf{x}\ $的边缘密度函数，我们已经对$\ \theta\ $进行了积分，此时它与$\ \theta\ $无关，或者说$\ m(\mathbf{x})\ $中不包含$\ \theta\ $的任何信息。因此能用来对$\ \theta\ $进行推断的仅仅是条件分布$\ \pi(\theta|\mathbf{x})$。它的计算公式如下所示：</p>
<script type="math/tex; mode=display">
\pi(\theta|\mathbf{x})=\frac{h(\mathbf{x},\theta)}{m(\mathbf{x})}=\frac{p(\mathbf{x}|\theta)\pi(\theta)}{\int_{\Theta}p(\mathbf{x}|\theta)\pi(\theta)d\theta}</script><p>这就是贝叶斯公式的密度函数形式。这个在样本$\ \mathbf{x}\ $给给定下，$\ \theta\ $的条件分布被称为$\ \theta\ $的后验愤分布。它是集中了总体、样本、先验这三种信息中有关$\ \theta\ $的一切信息，而又是派出了一切与$\ \theta\ $无关的信息之后所得到的结果。</p>
</li>
<li><p>在离散情况下，先验分布可用先验分布列$\ \pi(\theta_i)\ $表示。此时后验分布也是离散形式：</p>
<script type="math/tex; mode=display">
\pi(\theta_i|\mathbf{x})=\frac{p(\mathbf{x}|\theta_i)\pi(\theta_i)}{\sum_jp(\mathbf{x}|\theta_j)\pi(\theta_j)},\quad i=1,2,...</script></li>
</ol>
<h4 id="后验分布是三种信息的综合"><a href="#后验分布是三种信息的综合" class="headerlink" title="后验分布是三种信息的综合"></a>后验分布是三种信息的综合</h4><p>一般来说，先验分布$\ \pi(\theta)\ $是反映人们在抽样之前对$\ \theta\ $的认识，后验分布$\ \pi(\theta|\mathbf{x})$则是反映了人们在抽样之后对$\ \theta\ $的认识。两者的差异是由于样本$\ \mathbf{x}\ $出现后（获得总体信息和样本信息）人们对$\ \theta\ $认识（先验信息）的一种调整。</p>
<h3 id="S-1-3-共轭先验分布"><a href="#S-1-3-共轭先验分布" class="headerlink" title="$\S 1.3\ $共轭先验分布"></a><center>$\S 1.3\ $共轭先验分布</center></h3><h4 id="共轭先验分布"><a href="#共轭先验分布" class="headerlink" title="共轭先验分布"></a>共轭先验分布</h4><p>共轭先验分布想法的产生源于我们希望先验分布和后验分布能具有某种一样的函数形式（它们可能会依赖于某些<strong>超参数</strong>，即先验分布中所含的未知参数），而随着新样本信息的获得，我们可以在同一个分布函数形式框架下仅通过超参数的改变就能更新后验分布，这将给我们的计算带来很大的便利。</p>
<p>可以想象到这是一种“实时驱动型”的迭代更新方式，每当有一个新样本出现，我们就可以将上一次更新后的后验分布视为先验分布，再进行一次参数更新，如此进行下去。</p>
<p>我们给共轭先验一个文字性的定义：设$\ \theta\ $是总体分布中的参数（或参数向量），$\ \pi(\theta)\ $是$\ \theta\ $的先验密度函数，假如由抽样信息算得的后验密度函数与$\ \pi(\theta)\ $有相同的函数形式，则称$\ \pi(\theta)\ $是$\ \theta\ $的（自然）共轭先验分布。</p>
<h4 id="后验分布的计算"><a href="#后验分布的计算" class="headerlink" title="后验分布的计算"></a>后验分布的计算</h4><p>经由$\ \S 1.2\ $的分析，我们已经知道了后验分布可以通过以下方式进行计算：</p>
<script type="math/tex; mode=display">
\pi(\theta|\mathbf{x})=\frac{h(\mathbf{x},\theta)}{m(\mathbf{x})}=\frac{p(\mathbf{x}|\theta)\pi(\theta)}{m(\mathbf{x})}</script><p>在实际计算过程中，由于我们计算的是密度函数，另外$\ m(\mathbf{x})\ $与$\ \theta\ $无关，仅仅是充当正则化因子（使得计算结果确实是一个密度函数），所以我们仅需考虑后验分布的核的函数形式：</p>
<script type="math/tex; mode=display">
\pi(\theta|\mathbf{x})\propto p(\mathbf{x}|\theta)\pi(\theta)</script><p>另外我们再稍微想一想：首先我们将$\ p(\mathbf{x}|\theta)\pi(\theta)\ $改写成如下形式：</p>
<script type="math/tex; mode=display">
\pi(\theta|\mathbf{x})\propto \prod_{i=1}^{n}p(x_i|\theta)\pi(\theta)</script><p>注意到$\ \prod_{i=1}^{n}p(x_i|\theta)\ $是我们所熟悉的似然函数，我们若要使先验和后验分布具有同样的形式，似然函数中参数的函数形式可能会给共轭先验的构造提供给一些思路。</p>
<h4 id="共轭先验分布的优缺点"><a href="#共轭先验分布的优缺点" class="headerlink" title="共轭先验分布的优缺点"></a>共轭先验分布的优缺点</h4><p>优点是显而易见的：</p>
<ul>
<li>计算方便</li>
<li>后验分布的一些参数能够得到很好的解释</li>
</ul>
<p>缺点：</p>
<ul>
<li>先验分布必须具有一定的合理性，否则强行使用共轭先验很可能会掩盖实际情况</li>
</ul>
<h4 id="常用的共轭先验分布"><a href="#常用的共轭先验分布" class="headerlink" title="常用的共轭先验分布"></a>常用的共轭先验分布</h4><p>共轭先验分布的选取是由似然函数$\ L(\theta)=p(\mathbf{x}|\theta)\ $中所含$\ \theta\ $的因式所决定的，即选与似然函数（$\ \theta\ $的函数）具有相同核的分布作为先验分布。若此想法得以实现，那么共轭先验分布就产生了。而似然函数又与总体分布的形式有着某些关联。在下表中，我们列出了在实际中常用的共轭先验分布：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">总体分布</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">共轭先验分布</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">二项分布</td>
<td style="text-align:center">成功概率</td>
<td style="text-align:center">贝塔分布$\ Be(\alpha,\beta)$</td>
</tr>
<tr>
<td style="text-align:center">泊松分布</td>
<td style="text-align:center">均值</td>
<td style="text-align:center">伽马分布$\ Ga(\alpha,\lambda)$</td>
</tr>
<tr>
<td style="text-align:center">指数分布</td>
<td style="text-align:center">均值的倒数</td>
<td style="text-align:center">伽马分布$\ Ga(\alpha,\lambda)$</td>
</tr>
<tr>
<td style="text-align:center">正态分布（方差已知）</td>
<td style="text-align:center">均值</td>
<td style="text-align:center">正态分布$\ N(\mu,\sigma^2)$</td>
</tr>
<tr>
<td style="text-align:center">正态分布（均值已知）</td>
<td style="text-align:center">方差</td>
<td style="text-align:center">倒伽马分布$\ IGa(\alpha,\lambda)$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="S-1-4-超参数及其确定"><a href="#S-1-4-超参数及其确定" class="headerlink" title="$\S 1.4\ $超参数及其确定"></a><center>$\S 1.4\ $超参数及其确定</center></h3><p>前面我们已经提到过超参数这个概念了。其实超参数的定义非常简单，就是先验分布中所含的未知参数。（看到这个定义时我们很容易产生一个自然的想法：如果参数可以是随机的，那么超参数是不是可以是随机的并服从一个先验分布。当然，这种想法是没有任何问题的，并且这在贝叶斯统计中称为多层先验——我们将在第三章再进行介绍。）</p>
<p>一般来说，共轭先验分布常含有超参数，而无信息先验分布一般不含有超参数，例如均分分布（等概率的取值表示大自然对参数的取值并没有任何偏好）。</p>
<p>共轭先验分布是一种有信息的先验分布，故其中所含的超参数应充分利用各种先验信息来进行确定。</p>
<p>如果以二项分布为例，二项分布成功概率$\ \theta\ $的共轭先验分布是贝塔分布$\ Be(\alpha,\beta)$，$\alpha,\beta\ $是超参数。我们可以通过以下几种方法进行超参数的确定：</p>
<ol>
<li>利用先验矩</li>
<li>利用先验分位数</li>
<li>利用先验矩和先验分位数</li>
<li>其他方法</li>
</ol>
<p>详细过程不予赘述，如果感兴趣的话可以直接阅读茆诗松所著《贝叶斯统计》第2版的P20~23或是相关的文献。</p>
<h3 id="S-1-5-多参数模型"><a href="#S-1-5-多参数模型" class="headerlink" title="$\S 1.5\ $多参数模型"></a><center>$\S 1.5\ $多参数模型</center></h3><h3 id="S-1-6-充分统计量"><a href="#S-1-6-充分统计量" class="headerlink" title="$\S 1.6\ $充分统计量"></a><center>$\S 1.6\ $充分统计量</center></h3><h4 id="充分统计量"><a href="#充分统计量" class="headerlink" title="充分统计量"></a>充分统计量</h4><p>在简化统计问题中，充分统计量是一个非常重要的概念。（回顾一下什么叫做统计量：一个仅有样本决定，而与参数无关的量，也即当我获得样本的观察值时，统计量的值也随之确定）</p>
<p>引入充分统计量的想法如下：首先我们需要认识到样本是我们进行一切统计推断的基础，它提供了我们进行统计推断的一切“证据”（或者说信息），所以没有样本就没有统计推断。而统计量是我们对样本进行的信息加工和处理。在加工的过程中，统计量所含的信息必定只减不增。而所谓充分性则是说我们在这个加工过程中应该要能把包含未知参数的全部信息都提取出来。</p>
<p>用数学语言来描述这件事情（经典统计中的充分统计量）可能就稍微难以理解一点：设$\ \mathbf{x}=(x_1,…,x_n)\ $是来自分布函数$\ F(x|\theta)\ $的一个样本，$\ T=T(\mathbf{x})\ $是统计量。假如在给定$\ T(\mathbf{x})=t\ $的条件下，$\ x\ $的条件分布与$\ \theta\ $无关，则称该统计量为$\ \theta\ $的充分统计量。</p>
<p>一般情况下，直接运用定义进行验证一个统计量的充分性是困难的，所幸我们有因子分解定理保证这种充分性的充要条件。</p>
<h4 id="因子分解定理"><a href="#因子分解定理" class="headerlink" title="因子分解定理"></a>因子分解定理</h4><p>一个统计量$\ T(\mathbf{x})\ $对参数$\ \theta\ $是充分的充要条件是存在一个$\ t\ $与$\ \theta\ $的函数$\ g(t,\theta)\ $和一个样本$\ \mathbf{x}\ $的函数$\ h(\mathbf{x})$，使得对任一样本$\ \mathbf{x}\ $和任意$\ \theta$，样本的联合密度$\ p(\mathbf{x}, \theta)\ $可表为它们的乘积，即</p>
<script type="math/tex; mode=display">
p(\mathbf{x}|\theta)=g(T(\mathbf{x}),\theta)h(\mathbf{x})</script><p>在贝叶斯统计中，充分统计量也有一个充要条件：设$\ \mathbf{x}=(x_1,…,x_n)\ $是来自密度函数$\ p(x|\theta)\ $的一个样本，$\ T=T(\mathbf{x})\ $是统计量，它的密度函数为$\ p(t|\theta)$，又设$\ \mathscr{H}=\{\pi(\theta)\}\ $是$\ \theta\ $的某个先验分布族，则$\ T(\mathbf{x})\ $为$\ \theta\ $的充分统计量的充要条件是对任一先验分布$\ \pi(\theta)\in\mathscr{H}$，有</p>
<script type="math/tex; mode=display">
\pi(\theta|T(\mathbf{x}))=\pi(\theta|\mathbf{x})</script><p>即用样本分布$\ p(\mathbf{x}|\theta)\ $算得的后验分布与<strong>统计量$\ T(\mathbf{x})\ $算得的后验分布</strong>（可能达到简化计算的目的）是相同的。</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>《贝叶斯统计》第2版  by 茆诗松，汤银才</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/17/Fundamentals-of-Unconstrained-Optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/17/Fundamentals-of-Unconstrained-Optimization/" class="post-title-link" itemprop="url">Fundamentals of Unconstrained Optimization</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-17 08:59:10" itemprop="dateCreated datePublished" datetime="2022-04-17T08:59:10+08:00">2022-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-30 10:53:31" itemprop="dateModified" datetime="2022-04-30T10:53:31+08:00">2022-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Numerical-Optimization/" itemprop="url" rel="index"><span itemprop="name">Numerical Optimization</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h3><p>Reminded that the general form of the optimization problem is as follows</p>
<script type="math/tex; mode=display">
\min_{x\in\R^n} f(x)\quad s.t.\
\begin{cases}
c_i(x)=0\quad i \in \mathcal{E}\\
c_i(x)\ge 0\quad i \in \mathcal{I}
\end{cases}</script><p>Now in unconstrained optimization, we minimize an objective function that depends on real variables, with no restrictions at all on the values of these variables. The mathematical formulation is</p>
<script type="math/tex; mode=display">
\min_{x\in\R^n}f(x)</script><p>where $\ x\in\R^n\ $ is a real vector with $\ n\ge 1\ $ components and $\ f:\R^n\rightarrow\R\ $ is a smooth function.</p>
<h3 id="What-Is-A-Solution"><a href="#What-Is-A-Solution" class="headerlink" title="What Is A Solution"></a>What Is A Solution</h3><h4 id="global-minimizer"><a href="#global-minimizer" class="headerlink" title="global minimizer"></a>global minimizer</h4><p>We say a point $\ x^*\ $ is a global minimizer if </p>
<script type="math/tex; mode=display">
f(x^*)\le f(x)\quad for\ all\ x\in\R^n</script><h4 id="local-minimizer"><a href="#local-minimizer" class="headerlink" title="local minimizer"></a>local minimizer</h4><p>Then a local minimizer is that the point is only achieves the smallest value of f in its neighborhood. Formally, we say a point $\ x^<em>\ $ is a local minimizer if there is a neighborhood $\ \mathcal{N}\ $ of $\ x^</em>\ $ such that  </p>
<script type="math/tex; mode=display">
f(x^*)\le f(x)\quad for\ all\ x\in\mathcal{N}</script><p>A point that satisfies this definition is sometimes called a weak local minimizer. A strict local minimizer is then the outright winner in its neighborhood. Formally, A point $\ x^*\ $ is a strict local minimizer</p>
<script type="math/tex; mode=display">
\exist\ \mathcal{N}\ s.t.\ f(x^*)\lt f(x),\ \forall x\in\mathcal{N}with\ x\ne x^*</script><p>The last type of minimizer is called an isolated minimizer, which there is a neighborhood $\ \mathcal{N}\ $ of $\ x^<em>\ $ such that $\ x^</em>\ $ is the only local minimizer in $\ \mathcal{N}\ $.</p>
<p>All isolated local minimizers are strict, while the reverse does not hold.</p>
<h3 id="Recognizing-A-Local-Minimum"><a href="#Recognizing-A-Local-Minimum" class="headerlink" title="Recognizing A Local Minimum"></a>Recognizing A Local Minimum</h3><p>It seems that we have to check all the points to make sure none of them has a smaller function value then as $\ x^<em>$’s did. Fortunately, supposing the objective function to be twice continuously differentiable, we may be able to tell that whether $\ x^</em>\ $is a local minimizer by examining just the gradient $\ \triangledown f(x^<em>)\ $and the Hessian matrix $\ \triangledown^2 f(x^</em>)$.</p>
<h4 id="Theorem-Taylor’s-Theorem"><a href="#Theorem-Taylor’s-Theorem" class="headerlink" title="Theorem (Taylor’s Theorem)"></a>Theorem (Taylor’s Theorem)</h4><p>suppose that $\ f:\R^n\rightarrow\R\ $is continuously differentiable and that $p \in \R^n$. Then we have that </p>
<script type="math/tex; mode=display">
f(x+p)=f(x)+\triangledown f(x+tp)^{T}p</script><p>for some $t\in (0,1)$. Moreover, if f is twice continuously differentiable, we have that </p>
<script type="math/tex; mode=display">
\triangledown f(x+p)=\triangledown f(x) + \int_{0}^{1}\triangledown^2f(x+tp)pdt</script><p>and that </p>
<script type="math/tex; mode=display">
f(x+p)=f(x)+\triangledown f(x)^{T}p+\frac 1{2}p^T\triangledown^2f(x+tp)p</script><p>for some $t\in (0,1)$.</p>
<h4 id="Theorem-First-Order-Necessary-Conditions"><a href="#Theorem-First-Order-Necessary-Conditions" class="headerlink" title="Theorem (First-Order Necessary Conditions)"></a>Theorem (First-Order Necessary Conditions)</h4><p>If $\ x^<em>\ $ is local minimizer and f is continuously differentiable in an open neighborhood of $\ x^</em>\ $, then $\ \triangledown f(x^*)=0$.</p>
<h4 id="Theorem-Second-Order-Necessary-Conditions"><a href="#Theorem-Second-Order-Necessary-Conditions" class="headerlink" title="Theorem (Second-Order Necessary Conditions)"></a>Theorem (Second-Order Necessary Conditions)</h4><p>If $\ x^<em>\ $is a local minimizer of f and $\ \triangledown^2f\ $ exists and is continuous in an open neighborhood of $\ x^</em>\ $, then $\ \triangledown f(x^<em>)=0\ $and $\ \triangledown^2 f(x^</em>)\ $is positive semidefinite.</p>
<h4 id="Theorem-Second-Order-Sufficient-Conditions"><a href="#Theorem-Second-Order-Sufficient-Conditions" class="headerlink" title="Theorem (Second-Order Sufficient Conditions)"></a>Theorem (Second-Order Sufficient Conditions)</h4><p>Suppose that  $\ \triangledown^2f\ $ is continuous in an open neighborhood of $\ x^<em>\ $, and that $\ \triangledown f(x^</em>)=0\ $and $\ \triangledown^2 f(x^<em>)\ $is positive definite. Then $\ x^</em>\ $ is a strict local minimizer of f.</p>
<h4 id="Theorem-Transformation-from-local-m-to-global-m"><a href="#Theorem-Transformation-from-local-m-to-global-m" class="headerlink" title="Theorem (Transformation from local-m to global-m)"></a>Theorem (Transformation from local-m to global-m)</h4><p>When f is convex, any local minimizer $\ x^<em>\ $is a global minimizer of f. If in addition f is differentiable, then any stationary point $\ x^</em>\ $is a global minimizer of f.</p>
<h3 id="Overview-of-Algorithm"><a href="#Overview-of-Algorithm" class="headerlink" title="Overview of Algorithm"></a>Overview of Algorithm</h3><p>Our idea is simple. Beginning at a starting point $\ x_0$, optimization algorithms generate a sequence of iterates $\ \{x_k\}_{k=0}^{\infty}\ $ that terminate when either no more progress can be made or when it seems that a solution point has been approximated by current point $\ x_k\ $with sufficient accuracy.</p>
<p>Intuitively, when we generate such a sequence of iterates, we hope that the corresponding function value sequence $\ \{f(x_k)\}_{k=0}^{\infty}\ $ ought to decease (if we try to solve a minimization problem, otherwise to increase when facing a maximization problem) or at least we can decrease the objective function value $\ f(x_k)\ $ with several steps of iteration, that is $\ f(x_k)\lt f(x_{k-m})$.</p>
<p>There are two fundamental strategies for moving from the current point $\ x_k\ $to a new iterate $\ x_{k+1}$. Most of the algorithms describe in this book follow one of these approaches.</p>
<h4 id="two-strategies-line-search-and-trust-region"><a href="#two-strategies-line-search-and-trust-region" class="headerlink" title="two strategies: line search and trust region"></a>two strategies: line search and trust region</h4><h4 id="line-search"><a href="#line-search" class="headerlink" title="line search"></a>line search</h4><p>In the <strong>line search</strong> strategy, the algorithm chooses a <strong>direction</strong> $\ p_k\ $and searches along this direction from the current iterate $\ x_k\ $for a new iterate with a lower function value. The distance to move along $\ p_k\ $can be found by approximately solving the following one dimensional minimization problem to find a <strong>step length</strong> $\ \alpha$:</p>
<script type="math/tex; mode=display">
\min_{\alpha\gt 0}f(x_k+\alpha p_k)</script><p>By solving the problem above exactly, we would derive the maximum benefit from the direction $\ p_k$, but an exact minimization may be expensive. Instead, the line search algorithm generates a limited number of trial step lengths until it finds one that loosely approximates the minimum of the problem above.</p>
<h4 id="trust-region"><a href="#trust-region" class="headerlink" title="trust region"></a>trust region</h4><p>In the second algorithmic strategy, known as trust region, the information gathered about f is used to construct a model function $\ m_k\ $whose behavior near the current point $\ x_k\ $is similar to that of the actual objective function f. Because the model $\ m_k\ $may be a good approximation of f when x is far from $\ x_k$. In other words, we restrict the search for a minimizer of $\ m_k\ $to some region around $\ x_k$. In other words, we find the candidate step p by approximately solving the following subproblem:</p>
<script type="math/tex; mode=display">
\min_{p}m_k(x_k+p),\quad wherex_k+p\ lies\ inside\ the\ trust\ region</script><p>If the candidates solution does not produce a sufficient decrease in f, we conclude that the trust region is too large, and we shrink it and re-solve the problem.</p>
<p>The model $\ m_k\ $in the problem above is usually defined to be a quadratic function of the form </p>
<script type="math/tex; mode=display">
m_k(x_k+p)=f_k+p^T\triangledown f_k+\frac1{2}p^TB_kp</script><p>where $\ f_k$, $\triangledown f_k$, and $B_k\ $are scalar, vector, and matrix, respectively. The matrix $\ B_k\ $is either the Hessian $\ \triangledown^2f_k\ $or some approximation to it.</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>Numerical Optimization (2nd) by Jorge Nocedal, Stephen J. Wright</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/15/Introduction-to-Numerical-Optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/15/Introduction-to-Numerical-Optimization/" class="post-title-link" itemprop="url">Introduction to Numerical Optimization</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-15 20:17:03" itemprop="dateCreated datePublished" datetime="2022-04-15T20:17:03+08:00">2022-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-30 10:53:08" itemprop="dateModified" datetime="2022-04-30T10:53:08+08:00">2022-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Numerical-Optimization/" itemprop="url" rel="index"><span itemprop="name">Numerical Optimization</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h3><p>Our goals is to find values of the variables that optimize the objectives. Often the variables are restricted, or constrained, in some way.</p>
<p>There is no universal optimization algorithm but rather a collection of algorithms, each of which is tailored to a particular type of optimization problem.</p>
<ul>
<li>optimality conditions: checking that the current set of variables is indeed the solution of the problem</li>
<li>sensitivity analysis: reveals the sensitivity of the solution to changes in the model and data.</li>
</ul>
<h3 id="Mathematical-Formulation"><a href="#Mathematical-Formulation" class="headerlink" title="Mathematical Formulation"></a>Mathematical Formulation</h3><p>We introduce some notations first:</p>
<ul>
<li>x is the vector of variables, also called unknowns or parameters</li>
<li>f is the objective function, a (scalar) function of x that we want to maximize or minimize</li>
<li>$c_i\ $are constraint functions, which are scalar functions of x that define equations and inequalities that the unknown vector x must satisfy</li>
</ul>
<p>Optimization problem can be written as follows by using the notations above:</p>
<script type="math/tex; mode=display">
\min_{x \in \R^n}\ f(x)\quad s.t.\ 
\begin{cases}
c_i(x) = 0\quad i \in \mathcal{E}\\
c_i(x)\ge 0\quad i \in \mathcal{I}
\end{cases}</script><p>Here $\ \mathcal{I}\ $and $\ \mathcal{E}\ $are sets of indexes for equality and inequality constraints, respectively.</p>
<ul>
<li>feasible region: the set of points satisfying all the constraints</li>
</ul>
<h3 id="Continuous-versus-Discrete-Optimization"><a href="#Continuous-versus-Discrete-Optimization" class="headerlink" title="Continuous versus Discrete Optimization"></a>Continuous versus Discrete Optimization</h3><h4 id="discrete-optimization"><a href="#discrete-optimization" class="headerlink" title="discrete optimization"></a>discrete optimization</h4><p>The defining feature of a discrete optimization problem is that the unknown x is drawn from a finite (but often very large) set.</p>
<h4 id="continuous-optimization"><a href="#continuous-optimization" class="headerlink" title="continuous optimization"></a>continuous optimization</h4><p>The feasible set is usually uncountably infinite, as when the components of x are allowed to be real numbers.</p>
<p>Continuous optimization problems are normally easier to solve because the smoothness of the functions makes it possible to use objective and constraint information at a particular point x to deduce information about the function’s behavior at all points close to x.</p>
<p>Continuous optimization techniques often play an important role in solving discrete optimization problems.</p>
<h3 id="Constrained-and-Unconstrained-Optimization"><a href="#Constrained-and-Unconstrained-Optimization" class="headerlink" title="Constrained and Unconstrained Optimization"></a>Constrained and Unconstrained Optimization</h3><h4 id="unconstrained-optimization"><a href="#unconstrained-optimization" class="headerlink" title="unconstrained optimization"></a>unconstrained optimization</h4><ul>
<li>$\mathcal{I} = \mathcal{E} = \emptyset$</li>
<li>replacement the constraints by the penalization terms added to objective function</li>
</ul>
<h4 id="constrained-optimization"><a href="#constrained-optimization" class="headerlink" title="constrained optimization"></a>constrained optimization</h4><h3 id="Stochastic-and-Deterministic-Optimization"><a href="#Stochastic-and-Deterministic-Optimization" class="headerlink" title="Stochastic and Deterministic Optimization"></a>Stochastic and Deterministic Optimization</h3><p>Stochastic optimization algorithms use these quantifications of the uncertainty to produce solutions that optimize the expected performance of the model.</p>
<ul>
<li>chance-constrained optimization: in which we ensure that the variables satisfy the given constraints to some specified probability</li>
<li>robust optimization: certain constraints are required to hold for all possible values of the uncertain data</li>
</ul>
<h3 id="Convexity"><a href="#Convexity" class="headerlink" title="Convexity"></a>Convexity</h3><p>First of all, we consider convex set.</p>
<h4 id="convex-set"><a href="#convex-set" class="headerlink" title="convex set"></a>convex set</h4><p>When we say a set is convex, it follows that for $\forall x \in S$ and $y\in S$, we have</p>
<script type="math/tex; mode=display">
\alpha x + (1-\alpha)y \in S \quad \forall \alpha\in[0,1]</script><h4 id="convex-function"><a href="#convex-function" class="headerlink" title="convex function"></a>convex function</h4><ul>
<li><p>convex function: if its domain S is a convex set and if for any two points x and y in S, the following property is satisfied</p>
<script type="math/tex; mode=display">
f(\alpha x+(1-\alpha)y)\le\alpha f(x)+(1-\alpha)f(y)\quad \forall \alpha \in[0,1]</script></li>
<li><p>strictly convex function: whenever $x \ne y$</p>
<script type="math/tex; mode=display">
f(\alpha x+(1-\alpha)y)\lt \alpha f(x)+(1-\alpha)f(y)\quad \forall \alpha \in[0,1]</script></li>
<li><p>convex function</p>
</li>
</ul>
<h4 id="global-solution"><a href="#global-solution" class="headerlink" title="global solution"></a>global solution</h4><p>If the objective function in the optimization problem and the feasible region are both convex, then any local solution of the problem is in fact a global solution.</p>
<h4 id="convex-programming"><a href="#convex-programming" class="headerlink" title="convex programming"></a>convex programming</h4><p>A special case of the general constrained optimization problem in which</p>
<ul>
<li>the objective function is convex</li>
<li>the equality constrain function $c_i(\cdot), i\in\mathcal{E}$, are linear</li>
<li>the inequality constrain function $c_i(\cdot), i\in\mathcal{I}$, are concave</li>
</ul>
<h3 id="Optimization-Algorithm"><a href="#Optimization-Algorithm" class="headerlink" title="Optimization Algorithm"></a>Optimization Algorithm</h3><p>Most strategies make use of the values of the objective function f, $c_i$, the constraint functions, and possibly the first and second derivatives of these functions. Some algorithms accumulate information gathered at previous iterations, while others use only local information obtained at the current point.</p>
<p>Aspects of judging whether the algorithm is a good or not:</p>
<ul>
<li>Robustness</li>
<li>Efficiency</li>
<li>Accuracy</li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>Numerical Optimization (2nd) by Jorge Nocedal, Stephen J. Wright</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/15/%E5%9B%9B%E4%B8%AD%E6%B1%87%E6%8A%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/15/%E5%9B%9B%E4%B8%AD%E6%B1%87%E6%8A%A5/" class="post-title-link" itemprop="url">四中汇报</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-15 13:22:02 / Modified: 13:44:05" itemprop="dateCreated datePublished" datetime="2022-04-15T13:22:02+08:00">2022-04-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Summary/" itemprop="url" rel="index"><span itemprop="name">Summary</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h4><p>在本月中，我的生活发生了很多变化，不仅仅是学习生活，更包括一些心理上的变化。</p>
<p>在这里我主要谈谈学习生活的变化，当然这不可避免的会谈及到心理层面的东西。</p>
<p>一是我暂缓了泛函分析的学习，原因有两个：</p>
<ul>
<li>泛函分析的学习达到了一个瓶颈，想要再继续深入学习下去需要花费我更加多的时间和精力。</li>
<li>心理层面的一些问题导致我需要一个比较宽松的，节奏比较舒缓的方式以确保能保证最低强度的学习</li>
</ul>
<p>二是偏微分方程的学习，基本上达成进度比学校快一章节的目标，这也很有预见性的给我上一点所提到的舒缓的学习节奏提供了缓冲的可能。</p>
<h4 id="srp"><a href="#srp" class="headerlink" title="srp"></a>srp</h4><p>开了短短不到一小时的会，与srp的指导老师和各位师兄见了面。本次srp项目一改往常的方式，不是每周一个组会汇报进展（考虑到大二大三的学生课程安排比较紧张，安排出一个大家都有空闲的时间统一开组会似乎都做不到），所以决定通过研究生带领一到两位本科生的方式。分配给我的师兄看起来非常的和蔼可亲哈哈哈，希望能够在他的带领下快速的成长起来。</p>
<p>夏栗老师首先提到了一件事，那就是让研究生们先带领我们学习做科研是这么样子的流程，这是一个很重要的问题，不过先按下不表。</p>
<p>ps.夏栗老师本尊看起来就非常像能读博士的人</p>
<h4 id="opencv"><a href="#opencv" class="headerlink" title="opencv"></a>opencv</h4><h4 id="BTM"><a href="#BTM" class="headerlink" title="BTM"></a>BTM</h4><p>本月比较有结果的工作就是完成了关于对欧式、美式看涨、看跌期权的二叉树定价模型，包括无股息、连续股息红利率、派发一次性股息情形、上升-敲出期权以及蝶式期权的定价。</p>
<h4 id="慢节奏"><a href="#慢节奏" class="headerlink" title="慢节奏"></a>慢节奏</h4><p>其实本月的工作强度并不是很大，并不像上个月那么高产和充满干劲。</p>
<h3 id="下个月目标"><a href="#下个月目标" class="headerlink" title="下个月目标"></a>下个月目标</h3><ul>
<li><p>摸索如何调整自己的节奏和情绪</p>
</li>
<li><p>正常更新五中汇报</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/08/Option-Price-Binary-Tree-Modeling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/08/Option-Price-Binary-Tree-Modeling/" class="post-title-link" itemprop="url">Option Price - Binary Tree Modeling</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-08 14:06:47 / Modified: 14:08:21" itemprop="dateCreated datePublished" datetime="2022-04-08T14:06:47+08:00">2022-04-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mathematical-Finance/" itemprop="url" rel="index"><span itemprop="name">Mathematical Finance</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a><center>第一部分</center></h3><p>已知某股票当前价格为100美元，股票波动率为25%，无风险利率为5%。考虑以该股票为标的的资产的期权。</p>
<h5 id="无股息"><a href="#无股息" class="headerlink" title="无股息"></a>无股息</h5><blockquote>
<p>假设股票在期权有效期内不支付股息，取步数为500，1000，1500，2000，利用二叉树模型对有效期为半年、执行价格为100美元的欧式和美式看涨、看跌期权定价，并针对数值结果进行合理的分析。</p>
</blockquote>
<p>看涨期权则是估计这个股票会涨，可以在未来以一定的价格买进；看跌期权是估计股价会跌，可以在未来以一定价格卖出。</p>
<p>美式期权<code>(American options)</code>是指允许期权的持有人在期权的有效期的到期日之前任何一天均可履行合约的期权；欧式期权<code>(European options)</code>是指仅允许期权的持有人在期权的有效期最后一天方可履行合约的期权。</p>
<center>代码示例</center>

<p>以欧式看涨期权为例：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span> = <span class="title">btm_EurCall</span><span class="params">(S0, K, vol, r, T, N)</span> </span></span><br><span class="line"><span class="comment">% 初始化参数</span></span><br><span class="line">dt = T/N; </span><br><span class="line">u = <span class="built_in">exp</span>(vol*<span class="built_in">sqrt</span>(dt));</span><br><span class="line">d = <span class="number">1</span>/u;</span><br><span class="line">p = (<span class="built_in">exp</span>(r*dt)-d)/(u-d);</span><br><span class="line"><span class="comment">% 创建期权价格数组并进行初始化</span></span><br><span class="line">V = <span class="built_in">zeros</span>(<span class="number">2</span>*N+<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span> = -N:<span class="number">2</span>:N</span><br><span class="line">    <span class="comment">% 最终节点期权的收益为到期日股票价格S_T减去执行价格K的正部</span></span><br><span class="line">    V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>(S0*u^<span class="built_in">j</span>-K, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 倒推</span></span><br><span class="line"><span class="keyword">for</span> n = N<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = -n:<span class="number">2</span>:n</span><br><span class="line">        <span class="comment">% 当前期权价格由前一步相邻两个期权价格以无风险期望贴现</span></span><br><span class="line">        V(<span class="built_in">j</span>+N+<span class="number">1</span>) = (p*V(<span class="built_in">j</span>+<span class="number">1</span>+N+<span class="number">1</span>) + (<span class="number">1</span>-p)*V(<span class="built_in">j</span><span class="number">-1</span>+N+<span class="number">1</span>))*<span class="built_in">exp</span>(-r*dt);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 返回初始时刻期权价格</span></span><br><span class="line">y = V(N+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<center>数值结果</center>

<p>首先我们先进行参数设定：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">S0 = <span class="number">100</span>; <span class="comment">% 股票初始价格</span></span><br><span class="line">r = <span class="number">0.05</span>; <span class="comment">% 无风险利率</span></span><br><span class="line">K = <span class="number">100</span>; <span class="comment">% 敲定价格</span></span><br><span class="line">N = <span class="number">100</span>:<span class="number">100</span>:<span class="number">2000</span>; <span class="comment">% 步数</span></span><br><span class="line">T = <span class="number">0.5</span>; <span class="comment">% 到期日时间</span></span><br><span class="line">vol = <span class="number">0.25</span>; <span class="comment">% 股票波动率</span></span><br></pre></td></tr></table></figure>
<p>以下是二叉树模型在不同步数设置下（<code>100:100:2000</code>）给出的数值结果：</p>
<ol>
<li><p>欧式看涨期权定价</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">eurcall = [];</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">length</span>(N)</span><br><span class="line">    call = btm_EurCall(S0, K, vol, r, T, N(<span class="built_in">i</span>));</span><br><span class="line">    eurcall = [eurcall, call];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">[blscall, blsput] = blsprice(S0, K, r, T, vol);</span><br><span class="line"><span class="built_in">plot</span>(N, eurcall, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">hline = refline([<span class="number">0</span> blscall]);</span><br><span class="line">hline.Color = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">ylim([<span class="number">8.242</span>, blscall+<span class="number">0.002</span>])</span><br><span class="line">xlabel(<span class="string">&#x27;steps&#x27;</span>)</span><br><span class="line">ylabel(<span class="string">&#x27;European Call Option Price&#x27;</span>)</span><br><span class="line"><span class="built_in">legend</span>(&#123;<span class="string">&#x27;Erucall&#x27;</span>,<span class="string">&#x27;blsprice&#x27;</span>&#125;, <span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;SouthEast&#x27;</span>)</span><br><span class="line"><span class="built_in">hold</span> off</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/1.png" style="zoom:50%;"></p>
<p>图中所示红线为<code>Black Scholes</code>所计算的期权价格，可以看到随着步数的增加，欧式看涨期权的价格逐渐逼近<code>blsprice</code>。</p>
</li>
<li><p>欧式看跌期权定价</p>
<p>类似上述的代码，我们可以得到不同步数设置下由二叉树模型所得的期权价格</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/2.png" style="zoom:50%;"></p>
<p>同样的，红线所示为<code>Black Scholes</code>所计算出的期权价格，我们的数值结果随着步数的增加同样在不断逼近该价格。结合第一点欧式看涨期权我们可以直观的看到欧式看涨期权的价格更贵。</p>
</li>
<li><p>美式看涨期权定价</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">amcall = [];</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">length</span>(N)</span><br><span class="line">    call = btm_AmCall(S0, K, vol, r, T, N(<span class="built_in">i</span>));</span><br><span class="line">    amcall = [amcall, call];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">plot</span>(N, amcall, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">xlabel(<span class="string">&#x27;steps&#x27;</span>)</span><br><span class="line">ylabel(<span class="string">&#x27;American Call Option Price&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/3.png" style="zoom:50%;"></p>
</li>
<li><p>美式看跌期权定价</p>
<p>相应的我们也给出美式看跌期权的数值结果</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/4.png" style="zoom:50%;"></p>
</li>
</ol>
<p>下面我们将美式期权与欧式期权进行横向对比：</p>
<ol>
<li><p>欧式看涨期权与美式看涨期权对比</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/5.png" style="zoom:50%;"></p>
<p>虽然美式看涨期权赋予期权持有人在到期日之前行使期权的权利，理论上美式期权的价格理应更高，但是由于看涨期权持有人在到期日之前行使期权并不能使他获得更多收益，所以在不派发股息的情况下，欧式与美式看涨期权价格并没有区别。</p>
</li>
<li><p>欧式看跌期权与美式看跌期权对比</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/6.png" style="zoom:50%;"></p>
<p>前面说到欧式与美式看涨期权价格在不派发股息的情况下并没有不同，但是对于看跌期权，情况则有所不同，美式看跌期权价格要比欧式看跌期权价格更高。</p>
</li>
</ol>
<h5 id="上升-敲出期权"><a href="#上升-敲出期权" class="headerlink" title="上升-敲出期权"></a>上升-敲出期权</h5><blockquote>
<p>仍然假设股票不支付股息，取步数为500，100，1500，200，利用二叉树模型对有效期为半年、执行价格为100美元的欧式和美式上升-敲出期权的价格，并针对结果给出金融解释。</p>
</blockquote>
<p>鲨鱼鳍期权又称为敲出期权<code>(knock-out options)</code>，属于障碍期权<code>(barrier options)</code>的一种。期权合约会事先设置好标的资产的价格区间，如果在合约约定的时间范围内，标的资产价格始终处于该区间中，这个期权就是一个普通的看涨或看跌期权；一旦标的资产价格跳出了该区间，该期权将自动敲出作废。鲨鱼鳍期权作为一种<strong>路径依赖</strong>的期权，<strong>限定了投资者可获的最大收益</strong>，所以相对于香草期权<strong>更便宜</strong>，对于相信标的资产在未来一段时间内会发生确定方向的变化，但是不会越过障碍价格的投资者非常有吸引力。</p>
<p>下表以上升-敲出看涨期权为例展示了多头方到期日的收益（期权价格不计入其中）</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>上升-敲出看涨期权的到期收益</th>
<th style="text-align:center">标的资产到期价格</th>
<th style="text-align:center">看涨期权多头到期日收益</th>
</tr>
</thead>
<tbody>
<tr>
<td>标的资产在合约期间不超过障碍价格</td>
<td style="text-align:center">$S_T&gt;=K$</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td></td>
<td style="text-align:center">$S_T&gt;K$</td>
<td style="text-align:center">$S_T-K$</td>
</tr>
<tr>
<td>标的资产在合约期间超过了障碍价格</td>
<td style="text-align:center">$S_T&gt;=K$</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td></td>
<td style="text-align:center">$S_T&gt;K$</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
</div>
<p>注意到对于一般的路径有关期权，我们并不能直接通过二叉树模型对期权进行定价，因为期权在到期日的收益依赖于股票价格路径，树末端节点处的收益并不明确。但是对于上述这种障碍期权，我们仍然可以使用二叉树模型对其进行定价。</p>
<center>代码示例</center>

<p>以美式上升-敲出期权为例：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span> = <span class="title">btm_AmUpAndOut</span><span class="params">(S0, K, vol, r, T, N, H)</span></span></span><br><span class="line"><span class="comment">% 参数初始化</span></span><br><span class="line">dt = T/N;</span><br><span class="line">u = <span class="built_in">exp</span>(vol*<span class="built_in">sqrt</span>(dt));</span><br><span class="line">d = <span class="number">1</span>/u;</span><br><span class="line">p = (<span class="built_in">exp</span>(r*dt)-d)/(u-d);</span><br><span class="line">k = <span class="built_in">ceil</span>(<span class="built_in">log</span>(H/S0)/<span class="built_in">log</span>(u)); <span class="comment">% 障碍</span></span><br><span class="line"><span class="comment">% 创建期权价格数组并进行初始化</span></span><br><span class="line">V = <span class="built_in">zeros</span>(<span class="number">2</span>*N+<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span> = -N:<span class="number">2</span>:N</span><br><span class="line">    V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>(S0*u^<span class="built_in">j</span>-K, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 倒推</span></span><br><span class="line"><span class="keyword">for</span> n = N<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = -n:<span class="number">2</span>:n</span><br><span class="line">        <span class="comment">% 当前期权价格为以下两者之间取最大值:</span></span><br><span class="line">        <span class="comment">% 1. 前一步相邻两个期权价格以无风险期望贴现</span></span><br><span class="line">        <span class="comment">% 2. 当前直接行使期权获得的收益</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">j</span> &lt; k</span><br><span class="line">            V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>((p*V(<span class="built_in">j</span>+<span class="number">1</span>+N+<span class="number">1</span>)+(<span class="number">1</span>-p)*V(<span class="built_in">j</span><span class="number">-1</span>+N+<span class="number">1</span>))*<span class="built_in">exp</span>(-r*dt), S0*u^<span class="built_in">j</span>-K);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span>      </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 返回初始时刻期权价格</span></span><br><span class="line">y = V(N+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<center>数值结果</center>

<p>我们首先进行参数的设定：假定障碍价格H为140</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">S0 = <span class="number">100</span>; <span class="comment">% 股票初始价格</span></span><br><span class="line">r = <span class="number">0.05</span>; <span class="comment">% 无风险利率</span></span><br><span class="line">K = <span class="number">100</span>; <span class="comment">% 敲定价格</span></span><br><span class="line">N = <span class="number">100</span>:<span class="number">100</span>:<span class="number">2000</span>; <span class="comment">% 步数</span></span><br><span class="line">T = <span class="number">0.5</span>; <span class="comment">% 到期日时间</span></span><br><span class="line">vol = <span class="number">0.25</span>; <span class="comment">% 股票波动率</span></span><br><span class="line">H = <span class="number">140</span>; <span class="comment">% 障碍价格 </span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>欧式上升-敲出期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/17.png" style="zoom:50%;"></p>
</li>
<li><p>美式上升-敲出期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/18.png" style="zoom:50%;"></p>
</li>
</ol>
<p>设置步数为2000，我们研究在不同障碍价格设定对欧式、美式上升-敲出期权的影响：</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/19.png" style="zoom:50%;"></p>
<p>可以看到障碍价格对欧式期权的影响要比美式期权的影响更大。直观上这也很好理解：美式期权赋予期权持有人在到期日之前行使期权的权利，所以当股票价格逼近障碍价格时，美式期权持有人很有可能提前行使期权。</p>
<h5 id="支付连续股息"><a href="#支付连续股息" class="headerlink" title="支付连续股息"></a>支付连续股息</h5><blockquote>
<p>假设股票支付连续股息，股票收益率为2%，取步数为500，1000，1500，2000，利用二叉树模型对有效期为半年、执行价格为100美元的欧式、美式看涨、看跌期权定价，并针对数值结果进行合理的分析。</p>
</blockquote>
<p>假设某股票支付连续收益率为$\ q\ $的股息。在风险中性世界里股息收益率加上资产收益<code>(capital gain)</code>率的总和等于$\ 𝑟$，股息收益率为$\ 𝑞$，因此资本收益率为$\ 𝑟−𝑞$。</p>
<ol>
<li><p>资本收益率的变化最终会导致股价上涨概率$\ p\ $的变化</p>
<script type="math/tex; mode=display">
p = \frac{e^{(r-q)\Delta t}-d}{u-d}</script></li>
<li><p>在风险中性世界里，期权的价格等于其未来价格的数学期望以无风险利率$\ r\ $进行贴现</p>
<script type="math/tex; mode=display">
f = [p*f_u + (1-p)*f_d]e^{-r\Delta t}</script></li>
</ol>
<center>代码示例</center>

<p>以美式看涨期权为例：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span> = <span class="title">btm_AmCall_ctDiv</span><span class="params">(S0, K, vol, r, T, N, q)</span></span></span><br><span class="line"><span class="comment">% 参数初始化</span></span><br><span class="line">dt = T/N;</span><br><span class="line">u = <span class="built_in">exp</span>(vol*<span class="built_in">sqrt</span>(dt));</span><br><span class="line">d = <span class="number">1</span>/u;</span><br><span class="line">p = (<span class="built_in">exp</span>((r-q)*dt)-d)/(u-d); <span class="comment">% 连续支付股息导致股票上涨概率发生变化</span></span><br><span class="line"><span class="comment">% 创建期权价格数组并进行初始化</span></span><br><span class="line">V = <span class="built_in">zeros</span>(<span class="number">2</span>*N+<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span> = -N:<span class="number">2</span>:N</span><br><span class="line">    V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>(S0*u^<span class="built_in">j</span>-K, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 倒推</span></span><br><span class="line"><span class="keyword">for</span> n = N<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = -n:<span class="number">2</span>:n</span><br><span class="line">        <span class="comment">% 当前期权价格为以下两者之间取最大值:</span></span><br><span class="line">        <span class="comment">% 1. 前一步相邻两个期权价格以无风险期望贴现</span></span><br><span class="line">        <span class="comment">% 2. 当前直接行使期权获得的收益</span></span><br><span class="line">        V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>((p*V(<span class="built_in">j</span>+<span class="number">1</span>+N+<span class="number">1</span>)+(<span class="number">1</span>-p)*V(<span class="built_in">j</span><span class="number">-1</span>+N+<span class="number">1</span>))*<span class="built_in">exp</span>(-r*dt), S0*u^<span class="built_in">j</span>-K);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 返回初始时刻期权价格</span></span><br><span class="line">y = V(N+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<center>数值结果</center>

<p>首先我们先进行参数设定：设定股票收益率为2%</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">S0 = <span class="number">100</span>; <span class="comment">% 股票初始价格</span></span><br><span class="line">r = <span class="number">0.05</span>; <span class="comment">% 无风险利率</span></span><br><span class="line">K = <span class="number">100</span>; <span class="comment">% 敲定价格</span></span><br><span class="line">N = <span class="number">100</span>:<span class="number">100</span>:<span class="number">2000</span>; <span class="comment">% 步数</span></span><br><span class="line">T = <span class="number">0.5</span>; <span class="comment">% 到期日时间</span></span><br><span class="line">vol = <span class="number">0.25</span>; <span class="comment">% 股票波动率</span></span><br><span class="line">q = <span class="number">0.02</span>; <span class="comment">% 股息率</span></span><br></pre></td></tr></table></figure>
<p>在呈现支付连续股息的结果时，将同时与无股息情形进行比较</p>
<ol>
<li><p>看涨期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/7.png" style="zoom:50%;"></p>
<p>在支付连续股息的情况下，看涨期权的价格下降，这是由于</p>
</li>
<li><p>看跌期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/8.png" style="zoom:50%;"></p>
<p>在支付连续股息的情况下，看跌期权价格有所上升。这是因为股息的存在降低了资本收益率，导致股票价格上涨的概率降低，而这对于看跌期权是有益的。</p>
</li>
</ol>
<h5 id="支付一次性股息"><a href="#支付一次性股息" class="headerlink" title="支付一次性股息"></a>支付一次性股息</h5><blockquote>
<p>假设该股票将于2个月后一次性支付股息，金额为当时股价的2%，取步数为500，1000，1500，2000，利用二叉树模型对有效期为半年、执行价格为100美元的欧式和美式看涨、看跌期权定价，并针对数值结果给出合理的分析。</p>
</blockquote>
<p>假定股票只在某个离散时刻点上支付一次股息，而且股息为当时股价的$\ \delta\ $倍，其他参数与没有股息情形下一样。</p>
<center>代码示例</center>

<p>以美式看跌期权为例：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span> = <span class="title">btm_AmPut_Div</span><span class="params">(S0, K, vol, r, T, N, delta, date)</span></span></span><br><span class="line"><span class="comment">% 参数初始化</span></span><br><span class="line">dt = T/N;</span><br><span class="line">u = <span class="built_in">exp</span>(vol*<span class="built_in">sqrt</span>(dt));</span><br><span class="line">d = <span class="number">1</span>/u;</span><br><span class="line">p = (<span class="built_in">exp</span>(r*dt)-d)/(u-d);</span><br><span class="line"><span class="built_in">i</span> = <span class="built_in">ceil</span>(N*date/T); <span class="comment">% 派发一次性股息对应的节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 创建期权价格数组并进行初始化</span></span><br><span class="line">V = <span class="built_in">zeros</span>(<span class="number">2</span>*N+<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span> = -N:<span class="number">2</span>:N</span><br><span class="line">    V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>(S0*u^<span class="built_in">j</span>*delta-K, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 倒推</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 除息日之后</span></span><br><span class="line"><span class="keyword">for</span> n = N<span class="number">-1</span>:<span class="number">-1</span>:<span class="built_in">i</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = -n:<span class="number">2</span>:n</span><br><span class="line">        <span class="comment">% 当前期权价格为以下两者之间取最大值:</span></span><br><span class="line">        <span class="comment">% 1. 前一步相邻两个期权价格以无风险期望贴现</span></span><br><span class="line">        <span class="comment">% 2. 当前直接行使期权获得的收益</span></span><br><span class="line">        V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>((p*V(<span class="built_in">j</span>+<span class="number">1</span>+N+<span class="number">1</span>)+(<span class="number">1</span>-p)*V(<span class="built_in">j</span><span class="number">-1</span>+N+<span class="number">1</span>))*<span class="built_in">exp</span>(-r*dt), K-S0*u^<span class="built_in">j</span>*(<span class="number">1</span>-delta));</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 除息日之前</span></span><br><span class="line"><span class="keyword">for</span> n = <span class="built_in">i</span><span class="number">-1</span>:<span class="number">-1</span>:<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = -n:<span class="number">2</span>:n</span><br><span class="line">        V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>((p*V(<span class="built_in">j</span>+<span class="number">1</span>+N+<span class="number">1</span>)+(<span class="number">1</span>-p)*V(<span class="built_in">j</span><span class="number">-1</span>+N+<span class="number">1</span>))*<span class="built_in">exp</span>(-r*dt), K-S0*u^<span class="built_in">j</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 返回初始时刻期权价格</span></span><br><span class="line">y = V(N+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<center>数值结果</center>

<p>首先我们先进行参数设定：设置一次性股息收益率为当前股票价格的2%，同时假设股息派发时间为2个月之后</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">S0 = <span class="number">100</span>; <span class="comment">% 股票初始价格</span></span><br><span class="line">r = <span class="number">0.05</span>; <span class="comment">% 无风险利率</span></span><br><span class="line">K = <span class="number">100</span>; <span class="comment">% 敲定价格</span></span><br><span class="line">N = <span class="number">100</span>:<span class="number">100</span>:<span class="number">2000</span>; <span class="comment">% 步数</span></span><br><span class="line">T = <span class="number">0.5</span>; <span class="comment">% 到期日时间</span></span><br><span class="line">vol = <span class="number">0.25</span>; <span class="comment">% 股票波动率</span></span><br><span class="line">delta = <span class="number">0.02</span>; <span class="comment">% 一次性股息收益率</span></span><br><span class="line">date = <span class="number">1</span>/<span class="number">6</span>; <span class="comment">% 股息派发时间</span></span><br></pre></td></tr></table></figure>
<p>下面我们将直接将支付一次性股息的情形与无股息情形进行对比：</p>
<ol>
<li><p>欧式看涨期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/13.png" style="zoom:50%;"></p>
</li>
<li><p>欧式看跌期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/14.png" style="zoom:50%;"></p>
</li>
<li><p>美式看涨期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/15.png" style="zoom:50%;"></p>
</li>
<li><p>美式看跌期权</p>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/16.png" style="zoom:50%;"></p>
</li>
</ol>
<h3 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a><center>第二部分</center></h3><p>已知某股票波动率为25%，无风险利率为5%。考虑以该股票为原生资产的半年期、敲定价格为100美元的欧式看涨、看跌期权。</p>
<blockquote>
<p>利用二叉树模型求出初始股票价格为$\ 90:1:110\ $时的欧式看涨、看跌期权的初始价格，并计算出相应的Delta值。</p>
</blockquote>
<p>假设在二叉树的某个节点上，股票价格和期权价格分别为$\ S_i\ $和$\ f_i\ $，下一步股票价格可能上涨到$\ uS_i\ $或者降为$\ dS_i\ $，相应的期权价格变成$\ f_{i,u}\ $或者$\ f_{i,d}\ $。</p>
<p>由无套利定价方法，我们知道看涨期权出售方可持有$\Delta = \frac{f_{i,u}-f_{i,d}}{uS_i-dS_i}\ $单位股票对冲掉卖出一份看涨期权所带来的风险。</p>
<p>由于每一个节点所计算出来的$\ \Delta\ $值不同，所以我们在利用股票和期权进行风险对冲时，我们需要不断调整所持股票的数量。</p>
<blockquote>
<p>已知蝶式期权时一种欧式期权，它在到期日的收益等于</p>
<script type="math/tex; mode=display">
max\{0,min\{S_T-90, 110-S_T\}\}</script><p>利用二叉树模型求出初始股票价格为$\ 90:1:110\ $时的蝶式期权的初始价格，并计算出相应点的Delta值。</p>
</blockquote>
<center>代码示例</center>

<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span> = <span class="title">btm_EurButterfly</span><span class="params">(S0, vol, r, T, N)</span> </span></span><br><span class="line"><span class="comment">% 初始化参数</span></span><br><span class="line">dt = T/N; </span><br><span class="line">u = <span class="built_in">exp</span>(vol*<span class="built_in">sqrt</span>(dt));</span><br><span class="line">d = <span class="number">1</span>/u;</span><br><span class="line">p = (<span class="built_in">exp</span>(r*dt)-d)/(u-d);</span><br><span class="line"><span class="comment">% 创建期权价格数组并进行初始化</span></span><br><span class="line">V = <span class="built_in">zeros</span>(<span class="number">2</span>*N+<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span> = -N:<span class="number">2</span>:N</span><br><span class="line">    <span class="comment">% 最终节点期权的收益为到期日股票价格S_T减去执行价格K的正部</span></span><br><span class="line">    V(<span class="built_in">j</span>+N+<span class="number">1</span>) = <span class="built_in">max</span>(<span class="built_in">min</span>(S0*u^<span class="built_in">j</span><span class="number">-90</span>, <span class="number">110</span>-S0*u^<span class="built_in">j</span>), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 倒推</span></span><br><span class="line"><span class="keyword">for</span> n = N<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = -n:<span class="number">2</span>:n</span><br><span class="line">        <span class="comment">% 当前期权价格由前一步相邻两个期权价格以无风险期望贴现</span></span><br><span class="line">        V(<span class="built_in">j</span>+N+<span class="number">1</span>) = (p*V(<span class="built_in">j</span>+<span class="number">1</span>+N+<span class="number">1</span>) + (<span class="number">1</span>-p)*V(<span class="built_in">j</span><span class="number">-1</span>+N+<span class="number">1</span>))*<span class="built_in">exp</span>(-r*dt);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 返回初始时刻期权价格</span></span><br><span class="line">y = V(N+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<center>数值结果</center>

<p>参数设定：设置股票价格为<code>90:1:110</code></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">S0 = <span class="number">90</span>:<span class="number">1</span>:<span class="number">110</span>; <span class="comment">% 股票初始价格</span></span><br><span class="line">r = <span class="number">0.05</span>; <span class="comment">% 无风险利率</span></span><br><span class="line">K = <span class="number">100</span>; <span class="comment">% 敲定价格</span></span><br><span class="line">N = <span class="number">2000</span>; <span class="comment">% 步数</span></span><br><span class="line">T = <span class="number">0.5</span>; <span class="comment">% 到期日时间</span></span><br><span class="line">vol = <span class="number">0.25</span>; <span class="comment">% 股票波动率</span></span><br></pre></td></tr></table></figure>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">length</span>(S0)</span><br><span class="line">    BF = btm_EurButterfly(S0(<span class="built_in">i</span>), vol, r, T, N);</span><br><span class="line">    eurBF = [eurBF, BF];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">plot</span>(S0, eurBF, <span class="string">&#x27;*&#x27;</span>, LineStyle=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">xlabel(<span class="string">&#x27;S_0 / Dollar&#x27;</span>)</span><br><span class="line">ylabel(<span class="string">&#x27;European Butterfly Options Price&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/08/Option-Price-Binary-Tree-Modeling/20.png" style="zoom:50%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/15/%E4%B8%89%E4%B8%AD%E6%B1%87%E6%8A%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/15/%E4%B8%89%E4%B8%AD%E6%B1%87%E6%8A%A5/" class="post-title-link" itemprop="url">三中汇报</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-15 15:42:15 / Modified: 15:43:27" itemprop="dateCreated datePublished" datetime="2022-03-15T15:42:15+08:00">2022-03-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Summary/" itemprop="url" rel="index"><span itemprop="name">Summary</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>It was so exciting to know that the ideas of some dead genius, could transport me and give me a <strong>glimmer of a higher realm</strong>.</p>
<p>振奋人心的是，我知道那些逝去的天才依然能够带我一把，去领略那更高的殿堂。</p>
<p>They held the belief, with a religious fervor, that the magic keys to the kingdom were in these books. The mysteries of life and how to live well were there for the seizing for those who <strong>read well and thought deeply</strong>.</p>
<p>他们怀着宗教般的热烈，相信通往极乐世界的魔法钥匙就在这些书中。生命的神秘以及美好生活的神性，就在这些书中，等着那些热爱阅读，思考深邃的人来发现。</p>
<p><strong>Intense struggling for the good</strong>.</p>
<p>对美好事物极力地争取。 </p>
</blockquote>
<p>三中汇报，其实就是在三月中旬对过往的一个月的工作和思想变化进行一些总结和反思。</p>
<h3 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h3><p>最开始想要做这件事情的动机是想通过在每月中旬进行过去一个月内工作的总结和反思达到类似ddl的效果——在过去的一个月内能够尽可能高效高质量的完成多一些工作这样子在下次做汇报时才能有东西可以写……（笑，人人都是ddl人）</p>
<h3 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h3><p>为了规范，要求在汇报中必须将过去一个月中的重要事情与重大思想转变进行有效的分析</p>
<blockquote id="fn_1">
<sup>1</sup>. 有效的分析意味着写在这里的总结必须是过去一个月中不断进行思考和权衡的分析，而不是应付式的公式化的回答，倘若只是像为了完成一个任务一样去做这样的汇报，那么这个汇报不如不做。<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a>
</blockquote>
<p>和反馈。同时在汇报末尾必须给出下个月应达成的目标。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h4><p>第一件事情我想要谈论的是关于学习方向和内容的改变。这学期我本来打算修习9门课：</p>
<ul>
<li>必修：<strong>偏微分方程</strong></li>
<li>选修：<strong>随机过程</strong>、数据挖掘与统计决策、<u>数理金融</u></li>
<li>旁听：<u>泛函分析</u>、蒙特卡罗方法、计算智能</li>
<li>通选：日本社会与文化、会计学</li>
<li>同时我还想在空闲时间学习：<strong>python</strong>、<u>统计学习方法</u>、测度论、离散数学</li>
<li>以及将过去一些知识进行复习：数学分析、概率论</li>
</ul>
<p>但是学了两周之后发现这对我来讲压力还是有点大，所以我最终还是想不能一下子将自己放在高压之下，即使想要进行高强度的学习，也要循序渐进。</p>
<p>以上标<strong>红色</strong>的就是学习的重点，我暂时将学习的中心放在这上面；另外标<u>下划线</u>的则是次重点。</p>
<p>其实思路很明确，首先必须要保证必修课<strong>偏微分方程</strong>的成绩。这是大学期间最后一门影响绩点的课程，所以在接下来的一个月中，全力以赴将这门课先搞定。</p>
<p>大概继续采取重点与次重点并进的方式，先搞定偏微分方程和泛函分析这两个大部头。</p>
<h4 id="关于笔记的问题"><a href="#关于笔记的问题" class="headerlink" title="关于笔记的问题"></a>关于笔记的问题</h4><p>过去这个月中我反而是将学习的中心有点放到了泛函分析上（虽然它并不被我列入学习的重点中，不过它确实很重要）</p>
<p>泛函分析是数学系本科阶段分析课程的巅峰，我也是出于一种对它的敬意和渴望在学习这门课的。所学习的课程是内蒙古大学孙炯老师所教授的泛函分析，他是一位很好的老师，讲课非常有逻辑性。</p>
<p>在这段时间的学习中我发现了一个严重的问题，那就是我因为不当的记笔记反而没有很好的掌握它的思想。</p>
<p>我想还是有必要重申一下听课笔记的事情：首先我必须先保证听课质量和吸收率，在听的过程中所记的笔记只能是对我有所启发的词汇或者是短句，不要将所有定理以及证明细节都写在笔记中。</p>
<p>我也不知道这种方法是否有效，尝试一个月吧。</p>
<p>最后，提醒自己一下，我之所以选择旁听这门课，是因为想摆脱考试的束缚，能够带着一种对知识强烈的渴望的心态学习它。</p>
<h4 id="srp-与-opencv"><a href="#srp-与-opencv" class="headerlink" title="srp 与 opencv"></a>srp 与 opencv</h4><p>第二件事情是申报了夏立老师的 srp ——基于机器学习进行神经元细胞的识别。不过目前并不知道这个项目是不是一个水项目……暂且当作它不是吧。</p>
<p>srp 要求对图像处理有些基础，那么这段时间我也是通过跟随别人做的一个项目进行 opencv 的学习。</p>
<p>申报 srp 的动机也应该提及一下：(undone)</p>
<h4 id="blog"><a href="#blog" class="headerlink" title="blog"></a>blog</h4><p>最近也是陆陆续续在更新博客，把我新学到的一些东西放在上面，不过基本上都是搬运或者翻译别人的东西，一个原因是我需要学习的东西还有很多，另外一点是原创性的东西做起来非常消耗精力，而且有一些新的点子放在草稿之上或许更加符合我这样一个（半吊子）数学系学生的习惯。</p>
<p>所以暂时我将我的博客定位为一个记录自己所学东西的一个地方，而且这些东西多数情况下是与一些技术相关的，而并不是与我本专业所学知识相关的。</p>
<p>虽然我也曾考虑过将自己学习数学和统计课程的一些想法和精要放在博客里，但是语言的组织和打数学公式非常耗时，所以我也在暂时搁置这个打算。</p>
<h3 id="下个月目标"><a href="#下个月目标" class="headerlink" title="下个月目标"></a>下个月目标</h3><ul>
<li>完成偏微分方程的学习，至少需要比学校进度快一个章节</li>
<li>随机过程的学习方式还需要再做调整</li>
<li>做好的笔记，而不是作完整的笔记</li>
<li>正常更新四中汇报</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/12/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B9%8B%E5%A4%84%E7%90%86%E7%BC%BA%E5%A4%B1%E5%80%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/12/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B9%8B%E5%A4%84%E7%90%86%E7%BC%BA%E5%A4%B1%E5%80%BC/" class="post-title-link" itemprop="url">数据清洗之处理缺失值</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-12 14:49:58 / Modified: 14:58:47" itemprop="dateCreated datePublished" datetime="2022-03-12T14:49:58+08:00">2022-03-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Cleaning/" itemprop="url" rel="index"><span itemprop="name">Data Cleaning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="丢弃缺失值-通过自动化工作流补全"><a href="#丢弃缺失值-通过自动化工作流补全" class="headerlink" title="丢弃缺失值 & 通过自动化工作流补全"></a><center>丢弃缺失值 & 通过自动化工作流补全</center></h2><blockquote>
<p>这是来自 Kaggle Learn 的 Data Cleaning 课程。</p>
<p>在这个课程中，你将会学习如何处理一些常见的数据清洗问题，自己动手完成五个练习，它们都是一些真实的、杂乱的数据集。</p>
</blockquote>
<h3 id="初窥数据集"><a href="#初窥数据集" class="headerlink" title="初窥数据集"></a>初窥数据集</h3><p>首先我们导入将要使用到的库和数据集。作为范例，这里使用到了美国足球比赛发生事件的数据集。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用的模块</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读入所有数据</span></span><br><span class="line">nfl_data = pd.read_csv(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置随机种子以供复现</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>当我们获得一个新的数据集的时候，我们需要做的第一件事情就是查看其中的一部分数据。这将有助于确定数据是否正确读入并且给我们一些进行下一步操作的启示。在这一案例中，缺失数据将会以<code>NaN</code>或者<code>None</code>的形式出现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据集的前五行</span></span><br><span class="line">nfl_data.head()</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>GameID</th>
<th>Drive</th>
<th>qtr</th>
<th>down</th>
<th>time</th>
<th>TimeUnder</th>
<th>TimeSecs</th>
<th>PlayTimeDiff</th>
<th>SideofField</th>
<th>…</th>
<th>yacEPA</th>
<th>Home_WP_pre</th>
<th>Away_WP_pre</th>
<th>Home_WP_post</th>
<th>Away_WP_post</th>
<th>Win_Prob</th>
<th>WPA</th>
<th>airWPA</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
<td>15:00</td>
<td>15</td>
<td>3600.0</td>
<td>0.0</td>
<td>TEN</td>
<td>…</td>
<td>NaN</td>
<td>0.485675</td>
<td>0.514325</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.485675</td>
<td>0.060758</td>
<td>NaN</td>
</tr>
<tr>
<td>1</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>1.0</td>
<td>14:53</td>
<td>15</td>
<td>3593.0</td>
<td>7.0</td>
<td>PIT</td>
<td>…</td>
<td>1.146076</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.546433</td>
<td>0.004655</td>
<td>-0.032244</td>
</tr>
<tr>
<td>2</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>2.0</td>
<td>14:16</td>
<td>15</td>
<td>3556.0</td>
<td>37.0</td>
<td>PIT</td>
<td>…</td>
<td>NaN</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.551088</td>
<td>-0.040295</td>
<td>NaN</td>
</tr>
<tr>
<td>3</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>3.0</td>
<td>13:35</td>
<td>14</td>
<td>3515.0</td>
<td>41.0</td>
<td>PIT</td>
<td>…</td>
<td>-5.031425</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.510793</td>
<td>-0.049576</td>
<td>0.106663</td>
</tr>
<tr>
<td>4</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>4.0</td>
<td>13:27</td>
<td>14</td>
<td>3507.0</td>
<td>8.0</td>
<td>PIT</td>
<td>…</td>
<td>NaN</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.558929</td>
<td>0.441071</td>
<td>0.461217</td>
<td>0.097712</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
<p>啊啊啊我们已经可以看到缺失数据的存在了！</p>
<h3 id="数据集中到底有多少缺失数据点呢？"><a href="#数据集中到底有多少缺失数据点呢？" class="headerlink" title="数据集中到底有多少缺失数据点呢？"></a>数据集中到底有多少缺失数据点呢？</h3><p>下面我们看看每一列都有多少缺失值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 得到每一行缺失值的个数</span></span><br><span class="line">missing_values_count = nfl_data.isnull().<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前十列的缺失值个数</span></span><br><span class="line">missing_values_count[<span class="number">0</span>:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Column Name</th>
<th style="text-align:center">Missing value numbers</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Date</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">GameID</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">Drive</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">qtr</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">down</td>
<td style="text-align:center">61154</td>
</tr>
<tr>
<td style="text-align:center">time</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">TimeUnder</td>
<td style="text-align:center">224</td>
</tr>
<tr>
<td style="text-align:center">TimeSecs</td>
<td style="text-align:center">224</td>
</tr>
<tr>
<td style="text-align:center">PlayTimeDiff</td>
<td style="text-align:center">444</td>
</tr>
<tr>
<td style="text-align:center">SideofField</td>
<td style="text-align:center">528</td>
</tr>
</tbody>
</table>
</div>
<p>看起来数据集中的缺失值还不少。此时计算数据的缺失百分比有助于我们俩了解问题的严重性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 总共有多少缺失值</span></span><br><span class="line">total_cells = np.product(nfl_data.shape)</span><br><span class="line">total_missing = missing_values_count.<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺失数据所占百分比</span></span><br><span class="line">percent_missing = (total_missing/total_cells)*<span class="number">100</span></span><br><span class="line"><span class="built_in">print</span>(percent_missing)</span><br><span class="line"></span><br><span class="line">Out[<span class="number">1</span>]:</span><br><span class="line"><span class="number">24.87214126835169</span></span><br></pre></td></tr></table></figure>
<p>哦偶，几乎四分之一的数据产生了缺失。那么下一步，我们就是要更仔细地查看一下每一列地缺失情况并且搞清楚究竟发生了什么状况。</p>
<h3 id="搞清楚为什么数据会缺失"><a href="#搞清楚为什么数据会缺失" class="headerlink" title="搞清楚为什么数据会缺失"></a>搞清楚为什么数据会缺失</h3><p><strong>数据直觉</strong>（或者说是<strong>数据敏感度</strong>？）是我们在进入数据科学领域非常关键的一点，简单来说就是要真切的对手头的数据进行观察并且尝试搞清楚为什么它会这样子以及它会对我们的数据分析产生什么影响。这可能会是数据科学令人感到非常沮丧的一部分，特别是当你初入一个领域并且没有相关的经验的时候。当面对缺失值的时候，你需要利用你的直觉想清楚为什么这个值会缺失。其中有一个十分重要的问题，或许你可以常常反问自己。</p>
<blockquote>
<p><strong>Is this value missing because it wasn’t recorded or because it doesn’t exist?</strong></p>
<p>这个值缺失究竟是因为它没有被记录还是因为它不存在？</p>
</blockquote>
<p>如果一个数据缺失仅仅是因为它压根不存在，那么你根本不需要费劲去猜它原来究竟是什么，你可能只是想让它保持<code>NaN</code>就行了。如果一个数据缺失是因为它没有被记录，那么你可以根据这一列的其他数据尝试去猜它的值究竟是什么。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前十列缺失值个数</span></span><br><span class="line">missing_values_count[<span class="number">0</span>:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p>(undone)</p>
<h3 id="丢弃缺失值"><a href="#丢弃缺失值" class="headerlink" title="丢弃缺失值"></a>丢弃缺失值</h3><p>如果你很着急或者没有什么理由搞清楚这些缺失值产生的原因，那么你可以选择简单地把含有缺失值的行或者列直接删除。（贴士：我通常不建议在一些重要的项目上使用这种方法，往往花费时间去浏览你的数据并且将每一列中所含缺失值都看一遍以真正了解你的数据集）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除所有带有缺失值的行（样本点）</span></span><br><span class="line">nfl_data.dropna()</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>GameID</th>
<th>Drive</th>
<th>qtr</th>
<th>down</th>
<th>time</th>
<th>TimeUnder</th>
<th>TimeSecs</th>
<th>PlayTimeDiff</th>
<th>SideofField</th>
<th>…</th>
<th>yacEPA</th>
<th>Home_WP_pre</th>
<th>Away_WP_pre</th>
<th>Home_WP_post</th>
<th>Away_WP_post</th>
<th>Win_Prob</th>
<th>WPA</th>
<th>airWPA</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>好家伙，看起来我们直接将所有数据都删除了！这是因为我们的每一行数据中都至少含有一个缺失值。移除至少含一个缺失值的那些列或许更有可行性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除所有至少有一个缺失值的列</span></span><br><span class="line">columns_with_na_dropped = nfl_data.dropna(axis=<span class="number">1</span>)</span><br><span class="line">columns_with_na_dropped.head()</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>GameID</th>
<th>Drive</th>
<th>qtr</th>
<th>TimeUnder</th>
<th>ydstogo</th>
<th>ydsnet</th>
<th>PlayAttempted</th>
<th>Yards.Gained</th>
<th>sp</th>
<th>…</th>
<th>Timeout_Indicator</th>
<th>Timeout_Team</th>
<th>posteam_timeouts_pre</th>
<th>HomeTimeouts_Remaining_Pre</th>
<th>AwayTimeouts_Remaining_Pre</th>
<th>HomeTimeouts_Remaining_Post</th>
<th>AwayTimeouts_Remaining_Post</th>
<th>ExPoint_Prob</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>39</td>
<td>0</td>
<td>…</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
</tr>
<tr>
<td>1</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>10</td>
<td>5</td>
<td>1</td>
<td>5</td>
<td>0</td>
<td>…</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
</tr>
<tr>
<td>2</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>-3</td>
<td>0</td>
<td>…</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
</tr>
<tr>
<td>3</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>8</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>…</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
</tr>
<tr>
<td>4</td>
<td>2009-09-10</td>
<td>2009091000</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>8</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>…</td>
<td>0</td>
<td>None</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>0.0</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们丢失了多少数据</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Columns in orginal dataset: %d \n&quot;</span> % nfl_data.shape[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Columns with na&#x27;s dropped: %d \n&quot;</span> % columns_with_na_dropped.shape[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">Out[<span class="number">2</span>]:</span><br><span class="line">Columns <span class="keyword">in</span> original dataset: <span class="number">102</span></span><br><span class="line">Columns <span class="keyword">with</span> na<span class="string">&#x27;s dropped: 41</span></span><br></pre></td></tr></table></figure>
<p>这样子我们丢失了不少数据，但是至少我们成功从我们的数据中移除了所有<code>NaN</code>数据。</p>
<h3 id="自动填充缺失值"><a href="#自动填充缺失值" class="headerlink" title="自动填充缺失值"></a>自动填充缺失值</h3><p>另一种选择时尝试填补这些缺失值，在下一部分，我们只取该数据集的一小部分以方便我们将数据输出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取NFL数据集中的一个小部分</span></span><br><span class="line">subset_nfl_data =  nfl_data.loc[:, <span class="string">&#x27;EPA&#x27;</span>:<span class="string">&#x27;Season&#x27;</span>].head()</span><br><span class="line">subset_nfl_data</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>EPA</th>
<th>airEPA</th>
<th>yacEPA</th>
<th>Home_WP_pre</th>
<th>Away_WP_pre</th>
<th>Home_WP_post</th>
<th>Away_WP_post</th>
<th>Win_Prob</th>
<th>WPA</th>
<th>airWPA</th>
<th>yacWPA</th>
<th>Season</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2.014474</td>
<td>NaN</td>
<td>NaN</td>
<td>0.485675</td>
<td>0.514325</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.485675</td>
<td>0.060758</td>
<td>NaN</td>
<td>NaN</td>
<td>2009</td>
</tr>
<tr>
<td>1</td>
<td>0.077907</td>
<td>-1.068169</td>
<td>1.146076</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.546433</td>
<td>0.004655</td>
<td>-0.032244</td>
<td>0.036899</td>
<td>2009</td>
</tr>
<tr>
<td>2</td>
<td>-1.402760</td>
<td>NaN</td>
<td>NaN</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.551088</td>
<td>-0.040295</td>
<td>NaN</td>
<td>NaN</td>
<td>2009</td>
</tr>
<tr>
<td>3</td>
<td>-1.712583</td>
<td>3.318841</td>
<td>-5.031425</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.510793</td>
<td>-0.049576</td>
<td>0.106663</td>
<td>-0.156239</td>
<td>2009</td>
</tr>
<tr>
<td>4</td>
<td>2.097796</td>
<td>NaN</td>
<td>NaN</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.558929</td>
<td>0.441071</td>
<td>0.461217</td>
<td>0.097712</td>
<td>NaN</td>
<td>NaN</td>
<td>2009</td>
</tr>
</tbody>
</table>
</div>
<p>我们可以使用<code>pandas</code>的<code>fillna()</code>函数对数据框中的元素进行填充。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将所有NA值替换为0</span></span><br><span class="line">subset_nfl_data.fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>EPA</th>
<th>airEPA</th>
<th>yacEPA</th>
<th>Home_WP_pre</th>
<th>Away_WP_pre</th>
<th>Home_WP_post</th>
<th>Away_WP_post</th>
<th>Win_Prob</th>
<th>WPA</th>
<th>airWPA</th>
<th>yacWPA</th>
<th>Season</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2.014474</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.485675</td>
<td>0.514325</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.485675</td>
<td>0.060758</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2009</td>
</tr>
<tr>
<td>1</td>
<td>0.077907</td>
<td>-1.068169</td>
<td>1.146076</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.546433</td>
<td>0.004655</td>
<td>-0.032244</td>
<td>0.036899</td>
<td>2009</td>
</tr>
<tr>
<td>2</td>
<td>-1.402760</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.551088</td>
<td>-0.040295</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2009</td>
</tr>
<tr>
<td>3</td>
<td>-1.712583</td>
<td>3.318841</td>
<td>-5.031425</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.510793</td>
<td>-0.049576</td>
<td>0.106663</td>
<td>-0.156239</td>
<td>2009</td>
</tr>
<tr>
<td>4</td>
<td>2.097796</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.558929</td>
<td>0.441071</td>
<td>0.461217</td>
<td>0.097712</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2009</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将所有 NA 替换为同一列中紧随其后的值，</span></span><br><span class="line"><span class="comment"># 然后将所有剩余的NA替换为 0</span></span><br><span class="line">subset_nfl_data.fillna(method=<span class="string">&quot;bfill&quot;</span>, axis=<span class="number">0</span>).fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>EPA</th>
<th>airEPA</th>
<th>yacEPA</th>
<th>Home_WP_pre</th>
<th>Away_WP_pre</th>
<th>Home_WP_post</th>
<th>Away_WP_post</th>
<th>Win_Prob</th>
<th>WPA</th>
<th>airWPA</th>
<th>yacWPA</th>
<th>Season</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2.014474</td>
<td>-1.068169</td>
<td>1.146076</td>
<td>0.485675</td>
<td>0.514325</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.485675</td>
<td>0.060758</td>
<td>-0.032244</td>
<td>0.036899</td>
<td>2009</td>
</tr>
<tr>
<td>1</td>
<td>0.077907</td>
<td>-1.068169</td>
<td>1.146076</td>
<td>0.546433</td>
<td>0.453567</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.546433</td>
<td>0.004655</td>
<td>-0.032244</td>
<td>0.036899</td>
<td>2009</td>
</tr>
<tr>
<td>2</td>
<td>-1.402760</td>
<td>3.318841</td>
<td>-5.031425</td>
<td>0.551088</td>
<td>0.448912</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.551088</td>
<td>-0.040295</td>
<td>0.106663</td>
<td>-0.156239</td>
<td>2009</td>
</tr>
<tr>
<td>3</td>
<td>-1.712583</td>
<td>3.318841</td>
<td>-5.031425</td>
<td>0.510793</td>
<td>0.489207</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.510793</td>
<td>-0.049576</td>
<td>0.106663</td>
<td>-0.156239</td>
<td>2009</td>
</tr>
<tr>
<td>4</td>
<td>2.097796</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.461217</td>
<td>0.538783</td>
<td>0.558929</td>
<td>0.441071</td>
<td>0.461217</td>
<td>0.097712</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2009</td>
</tr>
</tbody>
</table>
</div>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> learntools.core <span class="keyword">import</span> binder </span><br><span class="line">binder.bind(<span class="built_in">globals</span>())</span><br><span class="line"><span class="keyword">from</span> learntools.data_cleaning.ex1 <span class="keyword">import</span> *</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Setup Complete!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Take a first look at the data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#modules we&#x27;ll use</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># read in all our data</span></span><br><span class="line">sf_permits = pd.read_csv(<span class="string">&quot;../input/building-permit-applications-data/Building_Permits.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set seed fot reproducibility</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># check the head of the dataset</span></span><br><span class="line">sf_permits.head()</span><br><span class="line"></span><br><span class="line"><span class="comment"># How many missing data points do we have?</span></span><br><span class="line">missing_values_count = sf_permits.isnull().<span class="built_in">sum</span>()</span><br><span class="line">total_cells = np.product(sf_permits.shape)</span><br><span class="line">total_missing = missing_values_count.<span class="built_in">sum</span>()</span><br><span class="line">percent_missing = (total_missing/total_cells)*<span class="number">100</span></span><br><span class="line"><span class="built_in">print</span>(percent_missing)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Figure out why the data is missing</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># drop missing values: rows</span></span><br><span class="line">columns_with_na_dropped = sf_permits.dropna()</span><br><span class="line"><span class="built_in">print</span>(columns_with_na_dropped.shape[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># undone</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/09/Iris-Dataset-Analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/09/Iris-Dataset-Analysis/" class="post-title-link" itemprop="url">Iris Dataset Analysis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-09 19:11:23" itemprop="dateCreated datePublished" datetime="2022-03-09T19:11:23+08:00">2022-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-12 15:08:29" itemprop="dateModified" datetime="2022-03-12T15:08:29+08:00">2022-03-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Analysis/" itemprop="url" rel="index"><span itemprop="name">Data Analysis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Iris数据集"><a href="#Iris数据集" class="headerlink" title="Iris数据集"></a><center>Iris数据集</center></h2><blockquote>
<center><font size="5">Iris Dataset</font></center>

<p>The Iris dataset was used in R.A. Fisher’s classic 1936 paper, The Use of Multiple Measurements in Taxonomic Problems, and can also be found on the UCI Machine Learning Repository.</p>
<p>It includes three iris species with 50 samples each as well as some properties about each flower. One flower species is linearly separable from the other two,but the other two are not linearly separable from each other.</p>
<p>The columns in this dataset are: Id, SepalLengthCm, SepalWidthCm, PetalLengthCm, PetalWidthCm, Species</p>
</blockquote>
<p>Iris 数据集是一个非常经典的数据集，大名鼎鼎的统计学家 Fisher 就在他1936年的论文中使用了这个数据集。你同样可以在许多关于机器学习的书籍中发现它的身影。你很容易在 <a target="_blank" rel="noopener" href="https://www.kaggle.com/">Kaggle</a> 上找到这个数据集，同时它在 <a target="_blank" rel="noopener" href="https://archive-beta.ics.uci.edu/">UCI Machine Learning Repository</a> 上也是十分受欢迎的数据集。</p>
<p>以下是数据集的下载链接：</p>
<ol>
<li>点击此处在 Kaggle 上 <a target="_blank" rel="noopener" href="https://www.kaggle.com/uciml/iris">下载</a> Iris Species 数据集</li>
<li>点击此处在 UCI 上 <a target="_blank" rel="noopener" href="https://archive-beta.ics.uci.edu/ml/datasets/iris">下载</a> Iris 数据集</li>
</ol>
<p>在整个数据集的分析过程中，我主要参考了 <a target="_blank" rel="noopener" href="https://www.kaggle.com/benhamner/python-data-visualizations">Python Data Visualizations | Kaggle</a> 这篇文章。至于参考的其他文章和资料，我会一并放在博客的最后。</p>
<h3 id="导入外部包和模块"><a href="#导入外部包和模块" class="headerlink" title="导入外部包和模块"></a>导入外部包和模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># current version of seaborn generates a bunch of warnings that we&#x27;ll ignore</span></span><br><span class="line"><span class="keyword">import</span> warnings </span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line">sns.set_theme(style=<span class="string">&quot;white&quot;</span>, color_codes=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#调取operating system模块</span></span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="comment">#import matplotlib.image as mpimg # mpimg 用于读取图片</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> PIL.Image <span class="keyword">as</span> Image</span><br><span class="line"><span class="keyword">import</span> rpy2.robjects <span class="keyword">as</span> robjects</span><br></pre></td></tr></table></figure>
<p><code>NumPy</code>库是 python 进行科学计算的基础库</p>
<p><code>Pandas</code>是数据分析必不可少的库，提供了高性能，并且易于使用的数据存储结构 DataFrame 和 Series 结构</p>
<p><code>Matplotlib</code>是常用的绘制的库，<code>Seaborn</code>是基于<code>Matplotlib</code>的图形可视化python包。 它提供了一种高度交互式界面，便于用户能够做出各种有吸引力的统计图表。</p>
<p><code>Rpy2</code>的作用是链接python和R，使得在python环境下可以使用R中的命令和函数。（当然没有这个库并不影响我们进行正常的数据分析）</p>
<p>如果发现没有相应的库，可以在 Anaconda Prompt 使用 pip 进行下载（以 rpy2 为例）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install rpy2</span><br></pre></td></tr></table></figure>
<h3 id="导入数据文件"><a href="#导入数据文件" class="headerlink" title="导入数据文件"></a>导入数据文件</h3><p>我将下载的 iris.csv 和 iris.data 文件和 python 脚本放在同一目录下，以下将展示这两种数据文件的导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&#x27;iris.csv&#x27;</span> <span class="comment"># 设置路径</span></span><br><span class="line">iris = pd.read_csv(path) <span class="comment"># 现在iris数据集已经变成了 DataFrame 结构</span></span><br></pre></td></tr></table></figure>
<p>而 data 文件可以通过以下方式导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&#x27;iris.data&#x27;</span></span><br><span class="line">iris = pd.read_csv(path, sep=<span class="string">&#x27;,&#x27;</span>) <span class="comment"># seq表示分隔符</span></span><br></pre></td></tr></table></figure>
<p>如果出现类似的报错 <code>No such file or directory: &#39;iris.csv&#39;</code>，那么检查一下当前工作目录 <code>cwd</code> (<code>current working dictionary</code>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os <span class="comment">#调取operating system模块</span></span><br><span class="line">cwd = os.getcwd()</span><br><span class="line"><span class="built_in">print</span>(cwd)</span><br></pre></td></tr></table></figure>
<p>然后会发现自己的数据集文件并不在这里面，接着我们更改工作目录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.chdir(<span class="string">&#x27;这里输入你要的文件的完整路径&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>此时再重复之前第一步操作就可以了。</p>
<h3 id="初步查看数据集信息"><a href="#初步查看数据集信息" class="headerlink" title="初步查看数据集信息"></a>初步查看数据集信息</h3><p>以下结果可以通过<code>print</code>函数进行输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据结构</span></span><br><span class="line"><span class="built_in">type</span>(iris) </span><br><span class="line"><span class="comment"># 查看数据集索引</span></span><br><span class="line">iris.index</span><br><span class="line"><span class="comment"># 查看数据集列名</span></span><br><span class="line">iris.columns</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">1</span>]:</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">pandas</span>.<span class="title">core</span>.<span class="title">frame</span>.<span class="title">DataFrame</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"><span class="title">RangeIndex</span>(<span class="params">start=<span class="number">0</span>, stop=<span class="number">150</span>, step=<span class="number">1</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">Index</span>(<span class="params">[<span class="string">&#x27;Id&#x27;</span>, <span class="string">&#x27;SepalLengthCm&#x27;</span>, <span class="string">&#x27;SepalWidthCm&#x27;</span>, <span class="string">&#x27;PetalLengthCm&#x27;</span>, <span class="string">&#x27;PetalWidthCm&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">       <span class="string">&#x27;Species&#x27;</span>],</span></span></span><br><span class="line"><span class="params"><span class="class">      dtype=<span class="string">&#x27;object&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure>
<p>数据集总共有6列，其中<code>SepalLengthCm</code>表示花萼长，<code>SepalWidthCm</code>表示花萼宽；<code>PetalLengthCm</code>表示花瓣长，<code>PetalWidthCm</code>表示花瓣宽；<code>Species</code>表示物种。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看变量名、数据类型以及检查是否有缺失</span></span><br><span class="line">iris.info()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">2</span>]:</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">pandas</span>.<span class="title">core</span>.<span class="title">frame</span>.<span class="title">DataFrame</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"><span class="title">RangeIndex</span>:</span> <span class="number">150</span> entries, <span class="number">0</span> to <span class="number">149</span></span><br><span class="line">Data columns (total <span class="number">6</span> columns):</span><br><span class="line"> <span class="comment">#   Column         Non-Null Count  Dtype  </span></span><br><span class="line">---  ------         --------------  -----  </span><br><span class="line"> <span class="number">0</span>   Id             <span class="number">150</span> non-null    int64  </span><br><span class="line"> <span class="number">1</span>   SepalLengthCm  <span class="number">150</span> non-null    float64</span><br><span class="line"> <span class="number">2</span>   SepalWidthCm   <span class="number">150</span> non-null    float64</span><br><span class="line"> <span class="number">3</span>   PetalLengthCm  <span class="number">150</span> non-null    float64</span><br><span class="line"> <span class="number">4</span>   PetalWidthCm   <span class="number">150</span> non-null    float64</span><br><span class="line"> <span class="number">5</span>   Species        <span class="number">150</span> non-null    <span class="built_in">object</span> </span><br><span class="line">dtypes: float64(<span class="number">4</span>), int64(<span class="number">1</span>), <span class="built_in">object</span>(<span class="number">1</span>)</span><br><span class="line">memory usage: <span class="number">7.2</span>+ KB</span><br></pre></td></tr></table></figure>
<p><code>iris.info()</code>可以将前面很多信息都显示出来。同时注意到这个数据集没有缺失值，这非常好！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看5个表头数据</span></span><br><span class="line">iris.head(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># 查看5个表尾数据</span></span><br><span class="line">iris.tail(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">3</span>]</span><br><span class="line"><span class="comment"># 查看5个表头数据</span></span><br><span class="line">   Id  SepalLengthCm  SepalWidthCm  PetalLengthCm  PetalWidthCm      Species</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>            <span class="number">5.1</span>           <span class="number">3.5</span>            <span class="number">1.4</span>           <span class="number">0.2</span>  Iris-setosa</span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>            <span class="number">4.9</span>           <span class="number">3.0</span>            <span class="number">1.4</span>           <span class="number">0.2</span>  Iris-setosa</span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>            <span class="number">4.7</span>           <span class="number">3.2</span>            <span class="number">1.3</span>           <span class="number">0.2</span>  Iris-setosa</span><br><span class="line"><span class="number">3</span>   <span class="number">4</span>            <span class="number">4.6</span>           <span class="number">3.1</span>            <span class="number">1.5</span>           <span class="number">0.2</span>  Iris-setosa</span><br><span class="line"><span class="number">4</span>   <span class="number">5</span>            <span class="number">5.0</span>           <span class="number">3.6</span>            <span class="number">1.4</span>           <span class="number">0.2</span>  Iris-setosa</span><br><span class="line"><span class="comment"># 查看5个表尾数据</span></span><br><span class="line">      Id  SepalLengthCm  ...  PetalWidthCm         Species</span><br><span class="line"><span class="number">145</span>  <span class="number">146</span>            <span class="number">6.7</span>  ...           <span class="number">2.3</span>  Iris-virginica</span><br><span class="line"><span class="number">146</span>  <span class="number">147</span>            <span class="number">6.3</span>  ...           <span class="number">1.9</span>  Iris-virginica</span><br><span class="line"><span class="number">147</span>  <span class="number">148</span>            <span class="number">6.5</span>  ...           <span class="number">2.0</span>  Iris-virginica</span><br><span class="line"><span class="number">148</span>  <span class="number">149</span>            <span class="number">6.2</span>  ...           <span class="number">2.3</span>  Iris-virginica</span><br><span class="line"><span class="number">149</span>  <span class="number">150</span>            <span class="number">5.9</span>  ...           <span class="number">1.8</span>  Iris-virginica</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看一些描述性信息</span></span><br><span class="line">iris.describe()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">4</span>]: </span><br><span class="line">               Id  SepalLengthCm  SepalWidthCm  PetalLengthCm  PetalWidthCm</span><br><span class="line">count  <span class="number">150.000000</span>     <span class="number">150.000000</span>    <span class="number">150.000000</span>     <span class="number">150.000000</span>    <span class="number">150.000000</span></span><br><span class="line">mean    <span class="number">75.500000</span>       <span class="number">5.843333</span>      <span class="number">3.054000</span>       <span class="number">3.758667</span>      <span class="number">1.198667</span></span><br><span class="line">std     <span class="number">43.445368</span>       <span class="number">0.828066</span>      <span class="number">0.433594</span>       <span class="number">1.764420</span>      <span class="number">0.763161</span></span><br><span class="line"><span class="built_in">min</span>      <span class="number">1.000000</span>       <span class="number">4.300000</span>      <span class="number">2.000000</span>       <span class="number">1.000000</span>      <span class="number">0.100000</span></span><br><span class="line"><span class="number">25</span>%     <span class="number">38.250000</span>       <span class="number">5.100000</span>      <span class="number">2.800000</span>       <span class="number">1.600000</span>      <span class="number">0.300000</span></span><br><span class="line"><span class="number">50</span>%     <span class="number">75.500000</span>       <span class="number">5.800000</span>      <span class="number">3.000000</span>       <span class="number">4.350000</span>      <span class="number">1.300000</span></span><br><span class="line"><span class="number">75</span>%    <span class="number">112.750000</span>       <span class="number">6.400000</span>      <span class="number">3.300000</span>       <span class="number">5.100000</span>      <span class="number">1.800000</span></span><br><span class="line"><span class="built_in">max</span>    <span class="number">150.000000</span>       <span class="number">7.900000</span>      <span class="number">4.400000</span>       <span class="number">6.900000</span>      <span class="number">2.500000</span></span><br></pre></td></tr></table></figure>
<p><code>describe()</code>会自动给出样本的均值、标准差；极值、分位数信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看每种鸢尾花各有多少个样本</span></span><br><span class="line">iris[<span class="string">&quot;Species&quot;</span>].value_counts()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">5</span>]: </span><br><span class="line">Iris-setosa        <span class="number">50</span></span><br><span class="line">Iris-versicolor    <span class="number">50</span></span><br><span class="line">Iris-virginica     <span class="number">50</span></span><br><span class="line">Name: Species, dtype: int64</span><br></pre></td></tr></table></figure>
<p>Iris 数据集总共有150个数据，其中包括3个物种<code>setosa</code>，<code>versicolor</code>和<code>virginica</code>，每个物种各50个样本。</p>
<details>  
    <summary><font size="3">Show Output</font></summary>
    <p>
        还没搞清楚怎么操作
    </p>
</details>



<h3 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h3><p>我们可以直接通过 <code>pandas dataframe</code> 的 <code>plot()</code> 函数进行 <code>scatter</code> 散点图绘制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分别将花瓣长宽、花萼长宽进行散点绘制</span></span><br><span class="line">iris.plot(kind=<span class="string">&quot;scatter&quot;</span>, x=<span class="string">&quot;SepalLengthCm&quot;</span>, y=<span class="string">&quot;SepalWidthCm&quot;</span>)</span><br><span class="line">iris.plot(kind=<span class="string">&quot;scatter&quot;</span>, x=<span class="string">&quot;PetalLengthCm&quot;</span>, y=<span class="string">&quot;PetalWidthCm&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/scatterplot_sl_sw.png" alt></p>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/scatterplot_pl_pw.png" alt></p>
<p>由下图的左下角推测我们可能可以直接通过花瓣分辨出一个物种（不过目前我们暂时还不知道这个物种是什么）。另外，我们可以观察到花瓣长宽之间有着很强的线性关系。</p>
<h4 id="seaborn"><a href="#seaborn" class="headerlink" title="seaborn"></a>seaborn</h4><p>我们先来大体介绍一下 <code>seaborn</code> 库的方法：</p>
<p>通过 <code>joinplot()</code> 函数来进行类似刚才的图像绘制, 同时还可以在旁边添加直方图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.jointplot(x=<span class="string">&quot;SepalLengthCm&quot;</span>, y=<span class="string">&quot;SepalWidthCm&quot;</span>, data=iris, size=<span class="number">5</span>)</span><br><span class="line">sns.jointplot(x=<span class="string">&quot;PetalLengthCm&quot;</span>, y=<span class="string">&quot;PetalWidthCm&quot;</span>, data=iris, size=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/joinplot_sl_sw.png" alt></p>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/joinplot_pl_pw.png" alt></p>
<p>与刚刚的图像稍微有点不同，<code>joinplot</code>还可以在旁边显示出直方图。</p>
<p>下面把物种信息也可视化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sns.FacetGrid(iris, hue=<span class="string">&quot;Species&quot;</span>, size=<span class="number">5</span>) </span><br><span class="line">   .<span class="built_in">map</span>(plt.scatter, <span class="string">&quot;SepalLengthCm&quot;</span>, <span class="string">&quot;SepalWidthCm&quot;</span>) .add_legend()</span><br><span class="line">plt.show()</span><br><span class="line">sns.FacetGrid(iris, hue=<span class="string">&quot;Species&quot;</span>, size=<span class="number">5</span>) </span><br><span class="line">   .<span class="built_in">map</span>(plt.scatter, <span class="string">&quot;PetalLengthCm&quot;</span>, <span class="string">&quot;PetalWidthCm&quot;</span>) .add_legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/Scatter_sl_sw.png" alt></p>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/Scatter_pl_pw.png" alt></p>
<p>不出我们所料，由花瓣长-宽信息 <code>PetalLengthCm</code> ，<code>PetalWidthCm</code> 我们就直接可以辨别一个物种 <code>setosa</code>。</p>
<p>绘制箱型图使用 <code>boxplot()</code> 函数，使用 <code>stripplot()</code> 函数将在原有图的基础上叠加散点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sns.boxplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;PetalLengthCm&quot;</span>, data=iris)</span><br><span class="line">sns.stripplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;PetalLengthCm&quot;</span>, data=iris, jitter=<span class="literal">True</span>,</span><br><span class="line">              edgecolor=<span class="string">&quot;gray&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/boxplot_stripplot.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将所有变量绘制成一张图</span></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>,<span class="number">10</span>))</span><br><span class="line">plt.suptitle(<span class="string">&quot;Boxplot &amp; StripPlot&quot;</span>, size=<span class="number">30</span>, y=<span class="number">0.95</span>)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">sns.boxplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;PetalLengthCm&quot;</span>, data=iris)</span><br><span class="line">sns.stripplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;PetalLengthCm&quot;</span>, data=iris, jitter=<span class="literal">True</span>, edgecolor=<span class="string">&quot;gray&quot;</span>)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">sns.boxplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;PetalWidthCm&quot;</span>, data=iris)</span><br><span class="line">sns.stripplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;PetalWidthCm&quot;</span>, data=iris, jitter=<span class="literal">True</span>, edgecolor=<span class="string">&quot;gray&quot;</span>)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">sns.boxplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;SepalLengthCm&quot;</span>, data=iris)</span><br><span class="line">sns.stripplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;SepalLengthCm&quot;</span>, data=iris, jitter=<span class="literal">True</span>, edgecolor=<span class="string">&quot;gray&quot;</span>)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">sns.boxplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;SepalWidthCm&quot;</span>, data=iris)</span><br><span class="line">sns.stripplot(x=<span class="string">&quot;Species&quot;</span>, y=<span class="string">&quot;SepalWidthCm&quot;</span>, data=iris, jitter=<span class="literal">True</span>, edgecolor=<span class="string">&quot;gray&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/BoxPlot & StripPlot.png" style="zoom:67%;"></p>
<p>绘制箱型图使用 <code>violinplot()</code> 函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将所有变量绘制成一张图</span></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">10</span>))</span><br><span class="line">plt.suptitle(<span class="string">&quot;ViolinPlot&quot;</span>, size=<span class="number">30</span>, y=<span class="number">0.95</span>)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">sns.violinplot(x=<span class="string">&#x27;Species&#x27;</span>, y=<span class="string">&#x27;PetalLengthCm&#x27;</span>,data=iris)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">sns.violinplot(x=<span class="string">&#x27;Species&#x27;</span>, y=<span class="string">&#x27;PetalWidthCm&#x27;</span>,data=iris)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">sns.violinplot(x=<span class="string">&#x27;Species&#x27;</span>, y=<span class="string">&#x27;SepalLengthCm&#x27;</span>,data=iris)</span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">sns.violinplot(x=<span class="string">&#x27;Species&#x27;</span>, y=<span class="string">&#x27;SepalWidthCm&#x27;</span>,data=iris)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/ViolinPlot.png" style="zoom:67%;"></p>
<p>绘制核密度估计图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 以花瓣长为例</span></span><br><span class="line">sns.FacetGrid(iris, hue=<span class="string">&quot;Species&quot;</span>, size=<span class="number">6</span>) \</span><br><span class="line">   .<span class="built_in">map</span>(sns.kdeplot, <span class="string">&quot;PetalLengthCm&quot;</span>) \</span><br><span class="line">   .add_legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>下面是双变量可视化方法：</p>
<p>使用 <code>paitplot()</code> 方法绘制配对-核密度估计-散点图。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.pairplot(iris.drop(<span class="string">&quot;Id&quot;</span>, axis=<span class="number">1</span>), hue=<span class="string">&quot;Species&quot;</span>, size=<span class="number">3</span>, diag_kind=<span class="string">&quot;kde&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>注意到我们使用到了 <code>.drop()</code> 函数，同时设定参数 <code>axis=1</code> ，它表示将数据集里列名为 <code>Id</code> 的那一列信息都剔除之后剩下的数据。</p>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/PairPlot_kde.png" style="zoom:67%;"></p>
<p>大致介绍一下函数参数所代表的含义：</p>
<ul>
<li><code>hue</code> 表示标签</li>
<li><code>diag_kind</code> 控制对角线上图像的绘制。默认 <strong>auto，</strong>还有 <strong>hist ，kde， None</strong></li>
<li><code>kind</code> 控制非对角线上图像的绘制。默认 <strong>scatter，</strong>还有 <strong>kde，hist，reg</strong></li>
<li>此外还可以用 <code>palette</code> 设置标签颜色</li>
</ul>
<p>更改参数 <code>diag_kind</code> 为 <code>hist</code> 绘制配对-直方-散点图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.pairplot(iris.drop(<span class="string">&quot;Id&quot;</span>, axis=<span class="number">1</span>), hue=<span class="string">&quot;Species&quot;</span>, size=<span class="number">3</span>, diag_kind=<span class="string">&quot;hist&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/PairPlot_hist.png" style="zoom:67%;"></p>
<p>除了对角线上的图形，我们通过 <code>kind</code> 参数更改非对角线上图的绘制，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非对角线上为回归图</span></span><br><span class="line">sns.pairplot(iris.drop(<span class="string">&quot;Id&quot;</span>, axis=<span class="number">1</span>), hue=<span class="string">&quot;Species&quot;</span>, size=<span class="number">3</span>, diag_kind=<span class="string">&quot;kde&quot;</span>,</span><br><span class="line">             kind=<span class="string">&quot;reg&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/PairPlot_kde_reg.png" style="zoom:67%;"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非对角线上为核密度估计图</span></span><br><span class="line">sns.pairplot(iris.drop(<span class="string">&quot;Id&quot;</span>, axis=<span class="number">1</span>), hue=<span class="string">&quot;Species&quot;</span>, size=<span class="number">3</span>, diag_kind=<span class="string">&quot;kde&quot;</span>,</span><br><span class="line">             kind=<span class="string">&quot;kde&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/PairPlot_kde_kde.png" style="zoom:67%;"></p>
<p>（不过这些图看起来越来越花里胡哨了。。。</p>
<p>最后我们再介绍相关系数矩阵图 <code>heatmap()</code> 绘制方法</p>
<ul>
<li><code>annot</code> 参数控制是否在格子中显示数据, <code>True</code> 显示</li>
<li><code>cmap</code> 参数用于调整颜色</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">7</span>, <span class="number">4</span>)) </span><br><span class="line"><span class="comment"># 利用 loc 进行列切片, 然后再计算 corr 相关系数矩阵</span></span><br><span class="line">sns.heatmap(iris.loc[:, <span class="string">&#x27;SepalLengthCm&#x27;</span>:<span class="string">&#x27;PetalWidthCm&#x27;</span>].corr(), annot=<span class="literal">True</span>, </span><br><span class="line">            cmap=sns.diverging_palette(<span class="number">10</span>, <span class="number">220</span>, sep=<span class="number">80</span>, n=<span class="number">7</span>))</span><br><span class="line"><span class="comment"># 也可以利用之前所用过的 drop</span></span><br><span class="line"><span class="comment"># sns.heatmap(iris.drop(&quot;Id&quot;, axis=1).corr(), annot=True,cmap=sns.diverging_palette(10, 220, sep=80, n=7))</span></span><br><span class="line">plt.title(<span class="string">&quot;HeatMap&quot;</span>, size=<span class="number">20</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/Heatmap.png" alt></p>
<p>那么以上 <code>seaborn</code> 库的方法就已经大致介绍完了，接下来是一些 <code>pandas</code> 库的方法。</p>
<h4 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h4><p>先是平平无奇的箱线图 <code>boxplot()</code> 绘制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iris.drop(<span class="string">&quot;Id&quot;</span>, axis=<span class="number">1</span>).boxplot(by=<span class="string">&quot;Species&quot;</span>, figsize=(<span class="number">12</span>, <span class="number">6</span>))</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/BoxPlot.png" style="zoom:80%;"></p>
<p>此外我们还可以使用一些多维可视化方法例如Andrews曲线以及平行坐标方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.plotting <span class="keyword">import</span> andrews_curves, parallel_coordinates</span><br><span class="line"><span class="comment"># Andrews 曲线图: 将每一个观测映射到一个函数上</span></span><br><span class="line">andrews_curves(iris.drop(<span class="string">&quot;Id&quot;</span>, axis=<span class="number">1</span>), <span class="string">&quot;Species&quot;</span>, color=</span><br><span class="line">               [<span class="string">&#x27;lightskyblue&#x27;</span>,<span class="string">&#x27;lightgreen&#x27;</span>,<span class="string">&#x27;orange&#x27;</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/Andrews_curves.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 平行坐标图</span></span><br><span class="line">parallel_coordinates(iris.drop(<span class="string">&quot;Id&quot;</span>, axis=<span class="number">1</span>), <span class="string">&quot;Species&quot;</span>, color=</span><br><span class="line">                     [<span class="string">&#x27;lightskyblue&#x27;</span>,<span class="string">&#x27;lightgreen&#x27;</span>,<span class="string">&#x27;orange&#x27;</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/Parallel_coordinates.png" alt></p>
<p>到这里，我们的数据可视化工作就已经进入到尾声了。</p>
<h4 id="嵌入R代码进行可视化"><a href="#嵌入R代码进行可视化" class="headerlink" title="嵌入R代码进行可视化"></a>嵌入R代码进行可视化</h4><p>在<a target="_blank" rel="noopener" href="https://www.kaggle.com/upadorprofzs/basic-visualization-techniques">Basic visualization techniques | Kaggle</a>上我看到了关于这个数据集非常精致的一种可视化方法</p>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/ridgeline.png" style="zoom: 25%;"></p>
<p>是不是挺惊艳的？</p>
<p>可惜这是用R实现的，而且由于 <code>ggplot</code> 的部分功能并没有在python对应的 <code>plotnine</code> 实现，所以最终我选择了在python中嵌入R代码实现 <code>ggplot</code> 可视化功能这一十分愚蠢而猥琐的方法。</p>
<p>首先导入我们所需要的库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import matplotlib.image as mpimg # mpimg 用于读取图片</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> PIL.Image <span class="keyword">as</span> Image</span><br><span class="line"><span class="keyword">import</span> rpy2.robjects <span class="keyword">as</span> robjects</span><br></pre></td></tr></table></figure>
<p>我们将R代码保存在 <code>r_scripts</code> 中，然后使用 <code>robjects.r()</code> 运行该部分代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">r_scripts = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">install.packages(&#x27;ggthemes&#x27;)</span></span><br><span class="line"><span class="string">install.packages(&#x27;tidyverse&#x27;)</span></span><br><span class="line"><span class="string">install.packages(&#x27;ggridges&#x27;)</span></span><br><span class="line"><span class="string">install.packages(&#x27;cowplot&#x27;)</span></span><br><span class="line"><span class="string">install.packages(&#x27;magick&#x27;)</span></span><br><span class="line"><span class="string">library(ggthemes)</span></span><br><span class="line"><span class="string">library(tidyverse)</span></span><br><span class="line"><span class="string">library(ggridges)</span></span><br><span class="line"><span class="string">library(cowplot)</span></span><br><span class="line"><span class="string">library(magick)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">getwd()</span></span><br><span class="line"><span class="string">setwd(&quot;C:/Users/xzy79/OneDrive/DISCIPLINE/DATA/Iris&quot;)</span></span><br><span class="line"><span class="string">dados &lt;- read.csv(&#x27;iris.csv&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tema &lt;- theme(plot.title=element_text(size=24, hjust=.5, vjust=1, color=&quot;white&quot;),</span></span><br><span class="line"><span class="string">              axis.title.y=element_text(size=22, vjust=2, color=&quot;white&quot;),</span></span><br><span class="line"><span class="string">              axis.title.x=element_text(size=22, vjust=-1, color=&quot;white&quot;),</span></span><br><span class="line"><span class="string">              axis.text.x=element_text(size=22, color=&quot;white&quot;),</span></span><br><span class="line"><span class="string">              axis.text.y=element_text(size=22, color=&quot;white&quot;),</span></span><br><span class="line"><span class="string">              legend.position=&quot;None&quot;)</span></span><br><span class="line"><span class="string">options(repr.plot.width=17, repr.plot.height=13)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sepallength &lt;- ggplot(data = dados, mapping = aes(x = SepalLengthCm, y = Species)) +</span></span><br><span class="line"><span class="string">  geom_density_ridges(mapping = aes(fill = Species), bandwidth=0.181,</span></span><br><span class="line"><span class="string">                      color = &quot;black&quot;, size = 1.5, alpha = .8) +</span></span><br><span class="line"><span class="string">  theme_solarized(light=FALSE)+</span></span><br><span class="line"><span class="string">  scale_colour_solarized(&#x27;blue&#x27;)+</span></span><br><span class="line"><span class="string">  xlab(&quot;Sepal Length&quot;) +</span></span><br><span class="line"><span class="string">  ggtitle(&quot;Sepal Length by Species&quot;) +</span></span><br><span class="line"><span class="string">  tema</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sepalwidth &lt;- ggplot(data = dados, mapping = aes(x = SepalWidthCm, y = Species)) +</span></span><br><span class="line"><span class="string">  geom_density_ridges(mapping = aes(fill = Species), bandwidth=0.134,</span></span><br><span class="line"><span class="string">                      color = &quot;black&quot;, size = 1.5, alpha = .8) +</span></span><br><span class="line"><span class="string">  theme_economist() +</span></span><br><span class="line"><span class="string">  theme_solarized(light=FALSE)+</span></span><br><span class="line"><span class="string">  scale_colour_solarized(&#x27;blue&#x27;)+</span></span><br><span class="line"><span class="string">  xlab(&quot;Sepal Width&quot;) +</span></span><br><span class="line"><span class="string">  ggtitle(&quot;Sepal Width by Species&quot;) +</span></span><br><span class="line"><span class="string">  tema</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">petallength &lt;- ggplot(data = dados, mapping = aes(x = PetalLengthCm, y = Species)) +</span></span><br><span class="line"><span class="string">  geom_density_ridges(mapping = aes(fill = Species), bandwidth=0.155,</span></span><br><span class="line"><span class="string">                      color = &quot;black&quot;, size = 1.5, alpha = .8) +</span></span><br><span class="line"><span class="string">  theme_economist() +</span></span><br><span class="line"><span class="string">  theme_solarized(light=FALSE)+</span></span><br><span class="line"><span class="string">  scale_colour_solarized(&#x27;blue&#x27;)+</span></span><br><span class="line"><span class="string">  xlab(&quot;Petal Length&quot;) +</span></span><br><span class="line"><span class="string">  ggtitle(&quot;Petal Length by Species&quot;) +</span></span><br><span class="line"><span class="string">  tema</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">petalwidth &lt;- ggplot(data = dados, mapping = aes(x = PetalWidthCm, y = Species)) +</span></span><br><span class="line"><span class="string">  geom_density_ridges(mapping = aes(fill = Species), bandwidth=0.075,</span></span><br><span class="line"><span class="string">                      color = &quot;black&quot;, size = 1.5, alpha = .8) +</span></span><br><span class="line"><span class="string">  theme_economist() +</span></span><br><span class="line"><span class="string">  theme_solarized(light=FALSE) +</span></span><br><span class="line"><span class="string">  scale_colour_solarized(&#x27;blue&#x27;) +</span></span><br><span class="line"><span class="string">  xlab(&quot;Petal Width&quot;) +</span></span><br><span class="line"><span class="string">  ggtitle(&quot;Petal Width by Species&quot;) +</span></span><br><span class="line"><span class="string">  tema</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">figure &lt;- image_graph(width = 2048, height = 1536, res = 96)</span></span><br><span class="line"><span class="string">print(plot_grid(sepallength, sepalwidth, petallength, petalwidth, ncol=2, nrow=2))</span></span><br><span class="line"><span class="string">image &lt;- image_write(figure, path = NULL, format = &quot;png&quot;)</span></span><br><span class="line"><span class="string">image_write(figure, path = &#x27;ridgeline.png&#x27;, format = &#x27;png&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">robjects.r(r_scripts) </span><br></pre></td></tr></table></figure>
<p>在刚刚的R代码中，我们将图像保存在png文件中，读取之后用 <code>imshow()</code> 输出图像</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">image_data = robjects.globalenv[<span class="string">&#x27;image&#x27;</span>]</span><br><span class="line">image = Image.<span class="built_in">open</span>(BytesIO(<span class="built_in">bytes</span>(image_data)))</span><br><span class="line"><span class="comment"># 或者从外部通过imread读取 png 文件</span></span><br><span class="line"><span class="comment">#image = mpimg.imread(&quot;ridgeline.png&quot;)</span></span><br><span class="line"><span class="comment">#image = Image.open(&#x27;ridgeline.png&#x27;)</span></span><br><span class="line"><span class="comment"># 分辨率参数-dpi，画布大小参数-figsize</span></span><br><span class="line"><span class="comment"># 如果存在显示不清晰的问题, 设置分辨率之后问题解决</span></span><br><span class="line">plt.figure(dpi=<span class="number">1000</span>, figsize=(<span class="number">8</span>, <span class="number">6</span>)) </span><br><span class="line">plt.imshow(image) <span class="comment"># 输出图像</span></span><br><span class="line">plt.axis(<span class="string">&#x27;off&#x27;</span>) <span class="comment"># 不显示坐标轴</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<h3 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h3><p>同样地，我们先导入必要的库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split <span class="comment"># 切分数据集为训练集和测试集</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression <span class="comment"># 逻辑回归模型</span></span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm <span class="comment">#最小二乘</span></span><br><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell <span class="comment"># 设置全部行输出</span></span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">&quot;all&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="数据集切分"><a href="#数据集切分" class="headerlink" title="数据集切分"></a>数据集切分</h4><p>利用 <code>sklearn</code> 函数 <code>train_test_split()</code> 将数据集分成训练数据集和测试数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">train, test = train_test_split(iris, test_size=<span class="number">0.3</span>)</span><br><span class="line"><span class="comment">#print(train.shape)</span></span><br><span class="line"><span class="comment">#print(test.shape)</span></span><br></pre></td></tr></table></figure>
<p>然后设定自变量和响应变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train_X = train.loc[:, <span class="string">&#x27;SepalLengthCm&#x27;</span>:<span class="string">&#x27;PetalWidthCm&#x27;</span>]</span><br><span class="line">train_y = train.Species</span><br><span class="line">test_X = test.loc[:, <span class="string">&#x27;SepalLengthCm&#x27;</span>:<span class="string">&#x27;PetalWidthCm&#x27;</span>]</span><br><span class="line">test_y = test.Species</span><br></pre></td></tr></table></figure>
<p>或者，我们也可以将两个步骤合起来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X = iris.loc[:, <span class="string">&#x27;SepalLengthCm&#x27;</span>:<span class="string">&#x27;PetalWidthCm&#x27;</span>]</span><br><span class="line">y = iris.Species</span><br><span class="line">train_X, test_X, train_y, test_y = train_test_split(X, y, test_size=<span class="number">0.3</span>)</span><br></pre></td></tr></table></figure>
<p>如果你已经忘记了，那么再次提醒一下<code>.loc[:, &#39;SepalLengthCm&#39;:&#39;PetalWidthCm&#39;]</code>和 <code>.drop(&quot;Id&quot;, axis=1)</code>都可以达到同样的效果。</p>
<h4 id="逻辑回归（sklearn）"><a href="#逻辑回归（sklearn）" class="headerlink" title="逻辑回归（sklearn）"></a>逻辑回归（sklearn）</h4><blockquote>
<center><font size="5">题外话</font></center>

<p>居然可以把<strong>逻辑回归</strong>翻译成<strong>逻辑斯蒂回归</strong>，真不知道是哪个小天才音译的，也是够可以的，一点逻辑都没有，听起来又蠢又拗口……（还有把 <strong>Robust</strong> 翻译成鲁棒性，服了……）</p>
</blockquote>
<p>逻辑回归是一种广义线性模型，它在传统的回归模型的基础上通过一个联系函数将值域映射到 $[0,1]$ 区间。（等有空我可以来写写线性回归模型还有广义线性模型的一些思想和理论）</p>
<p>我们先大致介绍一下<code>sklearn</code>中的模型<code>LogisticRegression()</code>的一些参数</p>
<ul>
<li><code>penalty</code>表示惩罚项（正则化参数），可选为 <strong>l1</strong>，<strong>l2</strong> 默认为 <strong>l2</strong>。在传统线性模型中，这两种惩罚项实际上是对应着不同的最优化问题。</li>
<li><code>C</code>是<strong>大于 0 </strong>的浮点数。C越小对损失函数的惩罚越重</li>
<li><code>solver</code>指定求解方式。可选有<strong>liblinear</strong>（梯度下降法），<strong>lbfgs</strong>（大型BFGS方法），<strong>newton-cg</strong>（牛顿-CG方法），<strong>sag</strong>（随机梯度下降），<strong>saga</strong>（随机梯度下降的优化）</li>
</ul>
<p>话不多说，开始训练。</p>
<p>首先进行全变量模型的回归拟合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lreg = LogisticRegression()</span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">lreg.fit(train_X, train_y)</span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">lreg_pred = lreg.predict(test_X)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The accuracy of the Logistics Regression is&quot;</span>,</span><br><span class="line">      metrics.accuracy_score(lreg_pred, test_y))</span><br></pre></td></tr></table></figure>
<p>结果显示预测精度达到 <script type="math/tex">95.56\%</script>。</p>
<p>接下来引入L1，L2惩罚项，我们来比较这两种方法的差异。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">lreg_l1 = LogisticRegression(penalty=<span class="string">&quot;l1&quot;</span>, C=<span class="number">0.5</span>, solver=<span class="string">&quot;liblinear&quot;</span>)</span><br><span class="line">lreg_l2 = LogisticRegression(penalty=<span class="string">&quot;l2&quot;</span>, C=<span class="number">0.5</span>, solver=<span class="string">&quot;liblinear&quot;</span>)</span><br><span class="line">lreg_l1.fit(train_X, train_y)</span><br><span class="line">lreg_l2.fit(train_X, train_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置不同的惩罚参数C, 并将每一次结果保存在以下列表中</span></span><br><span class="line">l1_train_pred = []</span><br><span class="line">l2_train_pred = []</span><br><span class="line">l1_test_pred = []</span><br><span class="line">l2_test_pred = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> np.linspace(<span class="number">0.01</span>, <span class="number">2</span>, <span class="number">50</span>):</span><br><span class="line">    lreg_l1 = LogisticRegression(penalty=<span class="string">&quot;l1&quot;</span>, C=c, solver=<span class="string">&quot;liblinear&quot;</span>, max_iter=<span class="number">1000</span>)</span><br><span class="line">    lreg_l2 = LogisticRegression(penalty=<span class="string">&quot;l2&quot;</span>, C=c, solver=<span class="string">&quot;liblinear&quot;</span>, max_iter=<span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    lreg_l1.fit(train_X, train_y)</span><br><span class="line">    l1_train_pred.append(metrics.accuracy_score(lreg_l1.predict(train_X), train_y))</span><br><span class="line">    l1_test_pred.append(metrics.accuracy_score(lreg_l1.predict(test_X), test_y))</span><br><span class="line">    </span><br><span class="line">    lreg_l2.fit(train_X, train_y)</span><br><span class="line">    l2_train_pred.append(metrics.accuracy_score(lreg_l2.predict(train_X), train_y))</span><br><span class="line">    l2_test_pred.append(metrics.accuracy_score(lreg_l2.predict(test_X), test_y))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘图</span></span><br><span class="line">data = [l1_train_pred, l1_test_pred, l2_train_pred, l2_test_pred]</span><br><span class="line">label = [<span class="string">&quot;l1_train&quot;</span>, <span class="string">&quot;l1_test&quot;</span>, <span class="string">&quot;l2_train&quot;</span>, <span class="string">&quot;l2_test&quot;</span>]</span><br><span class="line">color = [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;#FFA500&#x27;</span>, <span class="string">&#x27;#4169E1&#x27;</span>, <span class="string">&#x27;#00BFFF&#x27;</span>]</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>, <span class="number">6</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    plt.plot(np.linspace(<span class="number">0.01</span>, <span class="number">2</span>, <span class="number">50</span>), data[i], label=label[i], color=color[i])</span><br><span class="line">plt.legend(loc=<span class="string">&quot;best&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/Iris-Dataset-Analysis/Lreg_compare_l1_l2.png" style="zoom:80%;"></p>
<p>在很久以前，L2惩罚项是比较受到统计学家的青睐的，这是由于它涉及参数向量模长的平方，在计算过程中比较方便，相比之下，L1惩罚项是参数各分量的绝对值之和，会产生导数不连续的点。但随着计算机的发展，类似L1惩罚项这种计算已经不会成为一种困扰，同时L1惩罚项所对应的参数向量具有稀疏性的特点，所以L1惩罚项也变得越来越受人们的关注和使用。</p>
<p>另外，在这里我还要提及一点，这可能也会是一些人的认识误区——那就是原本的模型和加了L1或者L2惩罚项的模型之间是否有着绝对的优劣之分。需要澄清的是，我们在统计上进行模型比较时，一定是在某个准则下来谈孰优孰劣的问题的，不同准则下得出的优劣比较结果可能不同。这里面涉及到两个问题，一是准则是否合理，是否符合实际情况，二是我们事先对数据做出的一些假定是否合理。这两个问题如果无法得到肯定的回答，那么我们就无法真的选出所谓“最优的”模型。</p>
<p>举个例子，我们考虑传统的线性回归模型，假定数据的噪声满足<strong>正态分布</strong>，那么在<strong>均方误差最小化的准则</strong>下，我们的最优解就是最小二乘解。此时若是有人说加了L2惩罚项或是什么牛鬼蛇神的模型更好，那么你就知道他一定是在吹大牛。而假定数据的可加噪声为拉普拉斯噪声，那么（忘了在什么准则下的）最优解就是L1正则化模型所对应的解。</p>
<h4 id="逻辑回归（statsmodels）"><a href="#逻辑回归（statsmodels）" class="headerlink" title="逻辑回归（statsmodels）"></a>逻辑回归（statsmodels）</h4><p>我们利用<code>statsmodels</code>模块中的广义线性模型来进行模型拟合。</p>
<p>首先自定义多元逻辑回归函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logitRegression</span>(<span class="params">data, train_test_split</span>):</span></span><br><span class="line">    <span class="comment"># 将数据分为训练数据集和测试数据集</span></span><br><span class="line">    trainSet, testSet = train_test_split(data, test_size=<span class="number">0.2</span>)</span><br><span class="line">    <span class="comment"># 训练模型并分析模型效果</span></span><br><span class="line">    lreg = trainModel(trainSet)</span><br><span class="line">    modelSummary(lreg)</span><br><span class="line">    interpretModel(lreg)</span><br><span class="line">    lreg = makePrediction(lreg, testSet)</span><br><span class="line">    <span class="comment">#evaluation(lreg)</span></span><br></pre></td></tr></table></figure>
<p>（<code>evaluation()</code>函数功能尚未完成）</p>
<p>其中调用的自定函数功能如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">trainModel</td>
<td style="text-align:center">训练模型</td>
</tr>
<tr>
<td style="text-align:center">modelSummary</td>
<td style="text-align:center">模型统计分析</td>
</tr>
<tr>
<td style="text-align:center">interpretModel</td>
<td style="text-align:center">模型解释</td>
</tr>
<tr>
<td style="text-align:center">makePrediction</td>
<td style="text-align:center">模型预测</td>
</tr>
<tr>
<td style="text-align:center">evaluation</td>
<td style="text-align:center">模型评价</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trainModel</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    搭建逻辑回归模型，并且训练模型</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    formula = <span class="string">&quot;Species_code ~ SepalLengthCm + SepalWidthCm + PetalLengthCm + PetalWidthCm&quot;</span></span><br><span class="line">    model = sm.GLM.from_formula(formula, data=data) <span class="comment"># 模型建立</span></span><br><span class="line">    lreg = model.fit() <span class="comment"># 模型拟合</span></span><br><span class="line">    <span class="keyword">return</span> lreg</span><br></pre></td></tr></table></figure>
<p>在这里我们调用<code>sm</code>模块的<code>GLM.from_formula()</code>方法，然后将我们要拟合的形式保存在<code>formula</code>变量中作为参数输入。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modelSummary</span>(<span class="params">lreg</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    分析逻辑回归模型的统计特性</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 整体统计分析结果</span></span><br><span class="line">    <span class="built_in">print</span>(lreg.summary())</span><br><span class="line">    <span class="comment"># 用 f test 检验各项系数是否等于0</span></span><br><span class="line">    A = np.identity(<span class="built_in">len</span>(lreg.params)) <span class="comment"># 检验矩阵</span></span><br><span class="line">    A = A[<span class="number">1</span>:,:] <span class="comment"># 除去截距项</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;检验所有参数是否显著不为0:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(lreg.f_test(A))</span><br></pre></td></tr></table></figure>
<p>在这里我们使用<code>f_test()</code>函数检验模型<strong>整体的显著性</strong>，也即<strong>所有参数是否显著的不为0</strong>。倘若检验的结果显示模型整体参数显著的不为0，那么我们也就没有必要使用这些变量进行模型拟合了，因为这些变量并不能对解释响应变量产生任何作用。</p>
<p>(未完待续)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/18/%E8%87%AA%E6%9D%80%E5%BC%8F%E5%BC%BA%E5%A5%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shaw">
      <meta itemprop="description" content="Was mich nicht umbringt, macht mich stärker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaw">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/18/%E8%87%AA%E6%9D%80%E5%BC%8F%E5%BC%BA%E5%A5%B8/" class="post-title-link" itemprop="url">以自杀相威胁与女方发生关系，是否构成强奸？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-11-18 18:57:55" itemprop="dateCreated datePublished" datetime="2021-11-18T18:57:55+08:00">2021-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-11-21 21:37:48" itemprop="dateModified" datetime="2021-11-21T21:37:48+08:00">2021-11-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>强奸，是一种违背被害人的意愿，使用暴力、胁迫或其他手段强行与被害人进行性交的强制性行为。</p>
</blockquote>
<p>&nbsp;</p>
<p>近日在阅读刑法学讲义时看到了这样一个问题：以自杀相威胁与女方发生关系，是否构成强奸？</p>
<p>虽然凭借着最朴素的情感，我感觉可能是构成强奸的，但是对此仍有疑惑，为此咨询了一位曾经读法学的”法学老哥“（以下简称“法老”）。</p>
<p>&nbsp;</p>
<p>我：法老，话说这种情况构成强奸吗？</p>
<p>法老：应该构成吧。</p>
<p>我：我也感觉是构成的。这明显不是女方自愿发生的行为，侵犯了女方的法益。</p>
<p>法老：对的，不过还要看以自杀相威胁究竟算不算”胁迫“。</p>
<p>&nbsp;</p>
<p>过了一会儿，法老：我咨询了一下其他人，我想确实是不构成的。</p>
<p>我内心：？？？）</p>
<p>法老：因为你不能以胁迫自己来强迫他人。</p>
<p>我：意思是自杀是一种自我伤害的行为，并不是以暴力或其他方式伤害女方，所以以这种方式来胁迫他人的说法是不成立的？</p>
<p>法老：对的。</p>
<p>法老继续解释：你女朋友跳进河里，你不会游泳不去救她，是无罪的。那男朋友要自杀，也没有救助的义务。</p>
<p>我：在这里甚至不是男朋友。</p>
<p>法老：对的。所以，去救了（同意性行为）就是自愿的行为。这从逻辑上是没有问题的。</p>
<p>法老还补充道：上面的逻辑对不对，关键在于，对于一个正常人来讲，是不会在那种时候去想这些的义务之类的，所以就是，出于善良的同意行为，能不能受到法律保护的问题。</p>
<p>&nbsp;</p>
<p>在逻辑上，“不能以伤害自己来胁迫他人，而没有’胁迫‘则不构成强奸”确实是正确的，但是我从情感上确实无法接受，希望未来能听到更多法律人的其他解释或异议，整理之后再做更新。</p>
<p>最后：出门在外，还是要保持警惕之心，真要遇到这种情况不要傻傻地妥协，及时报警处理才是正确方式，切不要为自己过于泛滥的“善心”买单。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Shaw"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Shaw</p>
  <div class="site-description" itemprop="description">Was mich nicht umbringt, macht mich stärker</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-10 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shaw</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
